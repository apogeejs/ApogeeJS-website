/*! apogee 0.6.0 */

var __globals__=window;apogee={},apogee.base={},apogee.base.mixin=function(e,t){for(var o in t)e.prototype[o]=t[o]},apogee.base.isPromise=function(e){return null!==e&&("object"==typeof e&&e.constructor===Promise)},apogee.base.deepFreeze=function(e){if(null!==e&&void 0!==e){var t,o=apogee.util.getObjectType(e);if("Object"==o){Object.freeze(e);for(t in e)apogee.base.deepFreeze(e[t])}else if("Array"==o)for(Object.freeze(e),t=0;t<e.length;t++)apogee.base.deepFreeze(e[t])}},apogee.base.createError=function(e,t,o){var a=new Error(e);return void 0!==t&&(a.isFatal=t),void 0!==o&&(a.baseError=o),a},apogee.base.getListInFirstButNotSecond=function(e,t){for(var o=[],a=0;a<e.length;a++){var n=e[a];t.indexOf(n)<0&&o.push(n)}return o},apogee.util={},apogee.util.stringHash=function(e){for(var t=0,o=0;o<e.length;o++)t=31*t+e.charCodeAt(o)&4294967295;return t},apogee.util.objectHash=function(e){var t=JSON.stringify(e);return stringHash(t)},apogee.util.constructors={String:"".constructor,Number:3..constructor,Boolean:(!0).constructor,Date:(new Date).constructor,Object:{}.constructor,Array:[].constructor,Function:function(){}.constructor},apogee.util.getObjectType=function(e){if(null===e)return"null";if(void 0===e)return"undefined";var t=e.constructor;for(var o in apogee.util.constructors)if(t==apogee.util.constructors[o])return o;return"Unknown"},apogee.util.jsonCopy=function(e){if(null===e)return null;if(void 0!==e)return JSON.parse(JSON.stringify(e))},apogee.util.formatString=function(e,t){var o=arguments;return e.replace(/{(\d+)}/g,function(e,t){var a=Number(t)+1;return o[a]})},apogee.util.readQueryField=function(e,t){var o=t||window.location.href,a=new RegExp("[?&]"+e+"=([^&#]*)","i").exec(o);return a?a[1]:null},apogee.util.getNormalizedCopy=function(e){var t;switch(apogee.util.getObjectType(e)){case"Object":t=apogee.util.getNormalizedObjectCopy(e);break;case"Array":t=apogee.util.getNormalizedArrayCopy(e);break;default:t=e}return t},apogee.util.getNormalizedObjectCopy=function(e){var t,o={},a=[];for(t in e)a.push(t);a.sort();for(var n=0;n<a.length;n++)o[t=a[n]]=apogee.util.getNormalizedCopy(e[t]);return o},apogee.util.getNormalizedArrayCopy=function(e){for(var t=[],o=0;o<e.length;o++){var a=e[o];t.push(apogee.util.getNormalizedCopy(a))}return t},apogee.net={},apogee.net.callbackRequest=function(e,t,o,a){var n=new XMLHttpRequest;n.onreadystatechange=function(){var e;if(4==n.readyState)if(200==n.status)try{t(n.responseText)}catch(e){o(e.message)}else n.status>=400?(e="Error in http request. Status: "+n.status,o(e)):0==n.status&&o(e="Preflight error in request. See console")},a||(a={});var r=a.method?a.method:"GET";if(n.open(r,e,!0),a.header)for(var i in a.header)n.setRequestHeader(i,a.header[i]);n.send(a.body)},apogee.net.textRequest=function(e,t){return new Promise(function(o,a){apogee.net.callbackRequest(e,o,a,t)})},apogee.net.jsonRequest=function(e,t){return apogee.net.textRequest(e,t).then(JSON.parse)},apogee.EventManager={},apogee.EventManager.init=function(){this.listenerTable={},this.handlerTable={}},apogee.EventManager.addListener=function(e,t){var o=this.listenerTable[e];o||(o=[],this.listenerTable[e]=o);for(var a=0;a<o.length;a++)if(o[a]==t)return;o.push(t)},apogee.EventManager.removeListener=function(e,t){var o=this.listenerTable[e];if(o){var a=o.indexOf(t);a>=0&&o.splice(a,1)}},apogee.EventManager.dispatchEvent=function(e,t){var o=this.listenerTable[e];if(o)for(var a=0;a<o.length;a++)o[a].call(null,t)},apogee.EventManager.addHandler=function(e,t){this.handlerTable[e]=t},apogee.EventManager.removeHandler=function(e){delete this.handlerTable[e]},apogee.EventManager.callHandler=function(e,t){var o=this.handlerTable[e];return o?o(t):void 0},apogee.ContextManager=function(e){this.contextHolder=e,this.contextList=[]},apogee.ContextManager.prototype.addToContextList=function(e){this.contextList.push(e)},apogee.ContextManager.prototype.removeFromContextList=function(e){var t=this.contextList.indexOf(e);t>=0&&this.contextList.splice(t,1)},apogee.ContextManager.prototype.clearContextList=function(){this.contextList=[]},apogee.ContextManager.prototype.getBaseData=function(e){return this.hierarchicalLookup("lookupData",e)},apogee.ContextManager.prototype.getImpactor=function(e){return this.hierarchicalLookup("lookupImpactor",e)},apogee.ContextManager.prototype.hierarchicalLookup=function(e,t){var o=this.lookup(e,t);if(void 0!==o)return o;if(this.contextHolder&&this.contextHolder.getOwner){var a=this.contextHolder.getOwner();if(a)return a.getContextManager().hierarchicalLookup(e,t)}},apogee.ContextManager.prototype.lookup=function(e,t){for(var o=0;o<this.contextList.length;o++){var a=this.contextList[o],n=this[e](a,t);if(void 0!==n)return n}},apogee.ContextManager.prototype.lookupData=function(e,t){if(e.parent){var o=e.parent.lookupChild(t);return o?o.getData():void 0}if(e.data)return e.data[t]},apogee.ContextManager.prototype.lookupImpactor=function(e,t){return e.parent?e.parent.lookupChildFromPathArray(t):void 0},apogee.codeCompiler={},apogee.codeCompiler.APOGEE_FORBIDDEN_NAMES={apogeeMessenger:!0,__initFunction:!0,__memberFunction:!0,__memberFunctionDebugHook:!0},apogee.codeCompiler.NAME_PATTERN=/[a-zA-Z_$][0-9a-zA-Z_$]*/,apogee.codeCompiler.validateTableName=function(e){var t={};return apogee.codeAnalysis.KEYWORDS[e]?(t.errorMessage="Illegal name: "+e+" - Javascript reserved keyword",t.valid=!1):apogee.codeAnalysis.EXCLUSION_NAMES[e]?(t.errorMessage="Illegal name: "+e+" - Javascript variable or value name",t.valid=!1):apogee.codeCompiler.APOGEE_FORBIDDEN_NAMES[e]?(t.errorMessage="Illegal name: "+e+" - Apogee reserved keyword",t.valid=!1):(t=apogee.codeCompiler.NAME_PATTERN.exec(e))&&t[0]===e?t.valid=!0:(t.errorMessage="Illegal name format: "+e,t.valid=!1),t},apogee.codeCompiler.processCode=function(e,t){var o=apogee.codeCompiler.createCombinedFunctionBody(e.argList,e.functionBody,e.supplementalCode,t),a=apogee.codeCompiler.MEMBER_LOCALS_TEXT+o,n=apogee.codeAnalysis.analyzeCode(a);if(!n.success)return e.errors=n.errors,e;e.varInfo=n.varInfo;var r=apogee.codeCompiler.createGeneratorFunction(e.varInfo,o);return e.generatorFunction=r,e},apogee.codeCompiler.createCombinedFunctionBody=function(e,t,o,a){var n=e.join(",");return apogee.util.formatString(apogee.codeCompiler.MEMBER_FUNCTION_FORMAT_TEXT,a,n,t,o)},apogee.codeCompiler.createGeneratorFunction=function(e,t){var o="",a="";for(var n in e){var r=e[n];"returnValue"===n||r.isLocal||(o+="var "+n+";\n",a+=n+' = contextManager.getBaseData("'+n+'");\n')}var i=apogee.util.formatString(apogee.codeCompiler.GENERATOR_FUNCTION_FORMAT_TEXT,o,a,t);return new Function("__initFunction","apogeeMessenger",i)},apogee.codeCompiler.MEMBER_FUNCTION_FORMAT_TEXT=["//{0}","","//supplemental code--------------","{3}","//end supplemental code----------","","//member function----------------","function __memberFunction({1}) {","//overhead code","if(!__initFunction()) return undefined;","__memberFunctionDebugHook();","","//user code","{2}","};","//end member function------------"].join("\n"),apogee.codeCompiler.MEMBER_LOCALS_TEXT="var __initFunction, apogeeMessenger, __memberFunction, __memberFunctionDebugHook;",apogee.codeCompiler.GENERATOR_FUNCTION_FORMAT_TEXT=["'use strict'","//declare context variables","{0}","//context setter","function __initializer(contextManager) {","{1}};","","//user code","{2}","return {","'memberFunction': __memberFunction,","'initializer': __initializer","};"].join("\n"),apogee.codeAnalysis={},apogee.codeAnalysis.syntax={AssignmentExpression:[{name:"left",modified:!0},{name:"right"}],ArrayExpression:[{name:"elements",list:!0}],ArrowFunctionExpression:[{name:"params",list:!0},{name:"body"},{name:"defaults",list:!0}],BlockStatement:[{name:"body",list:!0}],BinaryExpression:[{name:"left"},{name:"right"}],BreakStatement:[],CallExpression:[{name:"callee"},{name:"arguments",list:!0}],CatchClause:[{name:"param",declaration:!0},{name:"body"}],ConditionalExpression:[{name:"test"},{name:"alternate"},{name:"consequent"}],ContinueStatement:[],DoWhileStatement:[{name:"body"},{name:"test",list:!0}],EmptyStatement:[],ExpressionStatement:[{name:"expression"}],ForStatement:[{name:"init"},{name:"test"},{name:"update",list:!0},{name:"body"}],ForOfStatement:[{name:"left"},{name:"right"},{name:"body"}],ForInStatement:[{name:"left"},{name:"right"},{name:"body"}],FunctionDeclaration:[{name:"id",declaration:!0},{name:"params",list:!0,declaration:!0},{name:"body"}],FunctionExpression:[{name:"id",declaration:!0},{name:"params",list:!0,declaration:!0},{name:"body"}],Identifier:[],IfStatement:[{name:"test"},{name:"consequent"},{name:"alternate"}],Literal:[],LabeledStatement:[{name:"body"}],LogicalExpression:[{name:"left"},{name:"right"}],MemberExpression:[],NewExpression:[{name:"callee"},{name:"arguments",list:!0}],Program:[{name:"body",list:!0}],Property:[],ReturnStatement:[{name:"argument"}],SequenceExpression:[{name:"expressions",list:!0}],ObjectExpression:[],SwitchCase:[{name:"test"},{name:"consequent",list:!0}],SwitchStatement:[{name:"discriminant"},{name:"cases",list:!0}],ThisExpression:[],ThrowStatement:[{name:"argument"}],TryStatement:[{name:"block"},{name:"handler"},{name:"finalizer",list:!0}],UnaryExpression:[{name:"argument"}],UpdateExpression:[{identifierNode:"argument",modified:!0}],VariableDeclaration:[{name:"declarations",list:!0,declaration:!0}],VariableDeclarator:[{name:"id",declaration:!0},{name:"init"}],WhileStatement:[{name:"body"},{name:"test",list:!0}],WithStatement:[{name:"object"},{name:"body"}],YieldExpression:[{name:"argument"}],ArrayPattern:null,AssignmentPattern:null,ClassBody:null,ClassDeclaration:null,ClassExpression:null,DebuggerStatement:null,ExportAllDeclaration:null,ExportDefaultDeclaration:null,ExportNamedDeclaration:null,ExportSpecifier:null,ImportDeclaration:null,ImportDefaultSpecifier:null,ImportNamespaceSpecifier:null,ImportSpecifier:null,MetaProperty:null,MethodDefinition:null,ObjectPattern:null,RestElement:null,SpreadElement:null,Super:null,TaggedTemplateExpression:null,TemplateElement:null,TemplateLiteral:null},apogee.codeAnalysis.KEYWORDS={abstract:!0,arguments:!0,boolean:!0,break:!0,byte:!0,case:!0,catch:!0,char:!0,class:!0,const:!0,continue:!0,debugger:!0,default:!0,delete:!0,do:!0,double:!0,else:!0,enum:!0,eval:!0,export:!0,extends:!0,false:!0,final:!0,finally:!0,float:!0,for:!0,function:!0,goto:!0,if:!0,implements:!0,import:!0,in:!0,instanceof:!0,int:!0,interface:!0,let:!0,long:!0,native:!0,new:!0,null:!0,package:!0,private:!0,protected:!0,public:!0,return:!0,short:!0,static:!0,super:!0,switch:!0,synchronized:!0,this:!0,throw:!0,throws:!0,transient:!0,true:!0,try:!0,typeof:!0,var:!0,void:!0,volatile:!0,while:!0,with:!0,yield:!0},apogee.codeAnalysis.EXCLUSION_NAMES={undefined:!0,Infinity:!0,NaN:!0,String:!0,Number:!0,Math:!0,Date:!0,Array:!0,Boolean:!0,Error:!0,RegExp:!0,console:!0},apogee.codeAnalysis.analyzeCode=function(e){try{var t={},o=esprima.parse(e,{tolerant:!0,loc:!0});if(o.errors&&o.errors.length>0){t.success=!1,t.errors=[];for(var a=0;a<o.errors.length;a++){var n=o.errors[a];(i=new apogee.ActionError(n.description,"Analyze - Code")).setParentException(n),t.errors.push(i)}}var r=apogee.codeAnalysis.getVariableInfo(o);return t.success=!0,t.varInfo=r,t}catch(e){var i=apogee.ActionError.processException(e,"Analyze - Code",!1);return t.success=!1,t.errors=[],t.errors.push(i),t}},apogee.codeAnalysis.getVariableInfo=function(e){var t={};t.nameTable={},t.scopeTable={};var o=apogee.codeAnalysis.startScope(t);return apogee.codeAnalysis.processTreeNode(t,e,!1,!1),apogee.codeAnalysis.endScope(t,o),apogee.codeAnalysis.markLocalVariables(t),t.nameTable},apogee.codeAnalysis.startScope=function(e){void 0===e.scopeIdGenerator&&(e.scopeIdGenerator=0);var t={};t.id=String(e.scopeIdGenerator++),t.parent=e.currentScope,t.localVariables={},e.scopeTable[t.id]=t,e.currentScope=t},apogee.codeAnalysis.endScope=function(e){var t=e.currentScope;t&&(e.currentScope=t.parent)},apogee.codeAnalysis.processTreeNode=function(e,t,o,a){if("Identifier"==t.type||"MemberExpression"==t.type)apogee.codeAnalysis.processVariable(e,t,o,a);else if("FunctionDeclaration"==t.type||"FunctionExpression"==t.type)apogee.codeAnalysis.processFunction(e,t);else{if("NewExpression"===t.type&&"Function"===t.callee.type)throw apogee.codeAnalysis.createParsingError("Function constructor not currently supported!",t.loc);apogee.codeAnalysis.processGenericNode(e,t)}},apogee.codeAnalysis.processGenericNode=function(e,t){var o=apogee.codeAnalysis.syntax[t.type];if(void 0===o)throw apogee.codeAnalysis.createParsingError("Syntax Tree Node not found: "+t.type,t.loc);if(null===o)throw apogee.codeAnalysis.createParsingError("Syntax node not supported: "+t.type,t.loc);for(var a=0;a<o.length;a++){var n=o[a],r=t[n.name];if(r)if(n.list)for(var i=0;i<r.length;i++)apogee.codeAnalysis.processTreeNode(e,r[i],n.modified,n.declaration);else apogee.codeAnalysis.processTreeNode(e,r,n.modified,n.declaration)}},apogee.codeAnalysis.processFunction=function(e,t){var o=t.type,a=t.id,n=t.params,r=t.body;"FunctionDeclaration"===o&&a&&apogee.codeAnalysis.processTreeNode(e,a,!1,!0);var i=apogee.codeAnalysis.startScope(e);"FunctionExpression"===o&&a&&apogee.codeAnalysis.processTreeNode(e,a,!1,!0);for(var p=0;p<n.length;p++)apogee.codeAnalysis.processTreeNode(e,n[p],!1,!0);apogee.codeAnalysis.processTreeNode(e,r,!1,!1),apogee.codeAnalysis.endScope(e,i)},apogee.codeAnalysis.processVariable=function(e,t,o,a){var n=this.getVariableDotPath(e,t);if(n){var r=n[0];if(!apogee.codeAnalysis.EXCLUSION_NAMES[r]){var i=e.nameTable[r];i||((i={}).name=r,i.uses=[],e.nameTable[r]=i);var p={};if(p.path=n,p.scope=e.currentScope,p.node=t,p.isModified=o,i.uses.push(p),a){var s=e.currentScope.localVariables;s[r]||(s[r]=!0)}}}},apogee.codeAnalysis.getVariableDotPath=function(e,t){if("Identifier"==t.type)return[t.name];if("MemberExpression"==t.type){if("CallExpression"==t.object.type)return this.processTreeNode(e,t.object,!1,!1),null;var o=this.getVariableDotPath(e,t.object);return t.computed?this.processTreeNode(e,t.property,!1,!1):o.push(t.property.name),o}throw this.createParsingError("Unknown application error: expected a variable identifier node.",t.loc)},apogee.codeAnalysis.markLocalVariables=function(e){for(var t in e.nameTable){for(var o=e.nameTable[t],a=o.name,n=!1,r=0;r<o.uses.length;r++){for(var i=o.uses[r],p=null,s=i.scope;s;s=s.parent)if(s.localVariables[a]){p=s;break}p?(i.isLocal=!0,i.declarationScope=p):n=!0}n||(o.isLocal=!0)}},apogee.codeAnalysis.createParsingError=function(e,t){var o=apogee.base.createError(e,!1);return t&&(o.lineNumber=t.start.line,o.column=t.start.column),o},apogee.codeDependencies={},apogee.codeDependencies.getDependencyInfo=function(e,t){var o=[],a={};for(var n in e)for(var r=e[n],i=0;i<r.uses.length;i++){var p=r.uses[i];if(!p.isLocal){var s=p.path,c=t.getImpactor(s);if(c){var l=c.getId();a[l]||(o.push(c),a[l]=!0)}}}return o},apogee.calculation={},apogee.calculation.addToRecalculateList=function(e,t){e.indexOf(t)>=0||(t.isDependent&&t.needsCalculating()&&(e.push(t),t.prepareForCalculate()),apogee.calculation.addDependsOnToRecalculateList(e,t))},apogee.calculation.addDependsOnToRecalculateList=function(e,t){for(var o=t.getImpactsList(),a=0;a<o.length;a++)apogee.calculation.addToRecalculateList(e,o[a])},apogee.calculation.callRecalculateList=function(e,t){var o,a,n=!0;for(a=0;a<e.length;a++)if((o=e[a]).getCalcPending()&&(o.calculate(),o.hasError())){var r=o.getErrors();if(r)for(var i=0;i<r.length;i++)t.addError(r[i]);n=!1}return n},apogee.action={},apogee.ActionResponse=function(){this.success=!0,this.errors=[],this.fatal=!1},apogee.ActionResponse.prototype.addError=function(e){this.success=!1,e.getIsFatal()&&(this.fatal=!0),this.errors.indexOf(e)<0&&this.errors.push(e)},apogee.ActionResponse.prototype.getSuccess=function(){return this.success},apogee.ActionResponse.prototype.getErrors=function(){return this.errors},apogee.ActionResponse.prototype.getErrorMsg=function(){return apogee.ActionResponse.getListErrorMsg(this.errors)},apogee.ActionResponse.getListErrorMsg=function(e){return e.map(e=>{var t="";return e.member&&(t+=e.member.getName()+": "),t+=e.msg}).join(";\n")},apogee.ActionError=function(e,t,o){this.msg=null!=e?e:apogee.ActionError.UNKNOWN_ERROR_MESSAGE,this.errorType=t,this.member=o,this.isFatal=!1,this.parentException=null},apogee.ActionError.ERROR_TYPE_APP="AppException",apogee.ActionError.ERROR_TYPE_MODEL="ModelException",apogee.ActionError.ERROR_TYPE_USER="UserException",apogee.ActionError.UNKNOWN_ERROR_MESSAGE="Unknown Error",apogee.ActionError.prototype.setParentException=function(e){this.parentException=e},apogee.ActionError.prototype.setIsFatal=function(e){this.isFatal=e},apogee.ActionError.prototype.getIsFatal=function(){return this.isFatal},apogee.ActionError.prototype.getType=function(){return this.errorType},apogee.ActionError.processException=function(e,t,o,a){e.stack&&console.error(e.stack);var n=a||"";e.message&&(n+=e.message),0==n.length&&(n="Unknown error");var r=new apogee.ActionError(n,t,null);r.setParentException(e);var i;return i=void 0!==e.isFatal?e.isFatal:o,r.setIsFatal(i),r},apogee.Member={},apogee.Member.init=function(e,t){this.id=apogee.Member._createId(),this.name=e,this.data=null,this.impactsList=[],this.generator=t,this.errors=[],this.resultPending=!1},apogee.Member.initOwner=function(e){this.owner=e,e.isParent?this.owner.addChild(this):e.isRootHolder&&this.owner.setRoot(this)},apogee.Member.move=function(e,t){this.owner&&this.owner.isParent&&this.owner.removeChild(this),this.name=e,this.initOwner(t)},apogee.Member.isMember=!0,apogee.Member.getId=function(){return this.id},apogee.Member.getName=function(){return this.name},apogee.Member.getFullName=function(){return this.owner?this.owner.getPossesionNameBase()+this.name:this.name},apogee.Member.getDisplayName=function(e){return e?this.getFullName():this.name},apogee.Member.getOwner=function(){return this.owner},apogee.Member.getParent=function(){return this.owner&&this.owner.isParent?this.owner:null},apogee.Member.getWorkspace=function(){return this.owner?this.owner.getWorkspace():null},apogee.Member.getRoot=function(){for(var e=this;e;){var t=e.getOwner();if(!t)return null;if(!t.isParent)return e;e=t}return null},apogee.Member.addError=function(e){this.errors.push(e)},apogee.Member.addErrors=function(e){this.errors=this.errors.concat(e)},apogee.Member.clearErrors=function(e){var t=[];if(null!=e)for(var o=0;o<this.errors.length;o++){var a=this.errors[o];a.type!=e&&t.push(a)}this.errors=t},apogee.Member.hasError=function(){return this.errors.length>0},apogee.Member.getErrors=function(){return this.errors},apogee.Member.getResultPending=function(){return this.resultPending},apogee.Member.setResultPending=function(e,t){this.resultPending=e,this.pendingToken=t},apogee.Member.pendingTokenMatches=function(e){return this.pendingToken===e},apogee.Member.getSetDataOk=function(){return this.generator.setDataOk},apogee.Member.getSetCodeOk=function(){return this.generator.setCodeOk},apogee.Member.toJson=function(){var e={};if(e.name=this.name,e.type=this.generator.type,this.addToJson&&this.addToJson(e),this.getUpdateData){var t=this.getUpdateData();e.updateData=t}return e},apogee.Member.getData=function(){return this.data},apogee.Member.getImpactsList=function(){return this.impactsList},apogee.Member.setData=function(e){this.data=e;var t=this.getParent();t&&t.updateData(this)},apogee.Member.onDeleteMember=function(){this.owner&&(this.owner.isParent?this.owner.removeChild(this):this.owner.isRootHolder&&this.owner.setRoot(null),this.owner=null)},apogee.Member.addToImpactsList=function(e){if(e!==this)return-1===this.impactsList.indexOf(e)&&(this.impactsList.push(e),!0)},apogee.Member.removeFromImpactsList=function(e){for(var t=0;t<this.impactsList.length;t++)if(this.impactsList[t]==e)return void this.impactsList.splice(t,1)},apogee.Member.nextId=1,apogee.Member._createId=function(){return apogee.Member.nextId++},apogee.ContextHolder={},apogee.ContextHolder.init=function(){this.contextManager=null},apogee.ContextHolder.isContextHolder=!0,apogee.ContextHolder.getContextManager=function(){return this.contextManager||(this.contextManager=this.createContextManager()),this.contextManager},apogee.ContextManager.prototype.getImpactor=function(e){return this.hierarchicalLookup("lookupImpactor",e)},apogee.Dependent={},apogee.Dependent.init=function(){this.dependsOnList=[],this.calcPending=!1},apogee.Dependent.isDependent=!0,apogee.Dependent.getDependsOn=function(){return this.dependsOnList},apogee.Dependent.getCalcPending=function(){return this.calcPending},apogee.Dependent.clearCalcPending=function(){this.calcPending=!1},apogee.Dependent.prepareForCalculate=function(){this.clearErrors(),this.setResultPending(!1),this.calcPending=!0},apogee.Dependent.initializeImpactors=function(){for(var e=[],t=!1,o=0;o<this.dependsOnList.length;o++){var a=this.dependsOnList[o];a.getCalcPending()&&a.calculate(),a.hasError()?e.push(a):a.getResultPending()&&(t=!0)}e.length>0?this.createDependencyError(e):t&&this.setResultPending(!0,apogee.action.DEPENDENT_PENDING_TOKEN)},apogee.Dependent.onDeleteDependent=function(){for(var e=0;e<this.dependsOnList.length;e++)this.dependsOnList[e].removeFromImpactsList(this)},apogee.Dependent.updateDependencies=function(e){var t=!1;e||(e=[]);var o=this.dependsOnList;this.dependsOnList=[];var a,n,r={};for(n=0;n<e.length;n++)a=e[n],this.dependsOnList.push(a),a.addToImpactsList(this)&&(t=!0),r[a.getId()]=!0;for(n=0;n<o.length;n++)r[(a=o[n]).getId()]||(a.removeFromImpactsList(this),t=!0);return t},apogee.Dependent.createDependencyError=function(e){for(var t="Error in dependency: ",o=0;o<e.length;o++)o>0&&(t+=", "),t+=e[o].getFullName();var a=new apogee.ActionError(t,"Calculation - Dependency",this);this.addError(a)},apogee.Codeable={},apogee.Codeable.init=function(e){this.argList=e,this.codeSet=!1,this.functionBody="",this.supplementalCode="",this.description="",this.varInfo=null,this.dependencyInfo=null,this.memberFunctionInitializer=null,this.memberFunction=null,this.codeErrors=[],this.clearCalcPending(),this.setResultPending(!1),this.calcInProgress=!1,this.functionInitialized=!1,this.initReturnValue=!1},apogee.Codeable.isCodeable=!0,apogee.Codeable.MEMBER_FUNCTION_PENDING="pending",apogee.Codeable.getArgList=function(){return this.argList},apogee.Codeable.getFunctionBody=function(){return this.functionBody},apogee.Codeable.getSupplementalCode=function(){return this.supplementalCode},apogee.Codeable.getDescription=function(){return this.description},apogee.Codeable.setDescription=function(e){this.description=e},apogee.Codeable.setCodeInfo=function(e){if(this.argList=e.argList,this.functionBody=e.functionBody,this.supplementalCode=e.supplementalCode,this.varInfo=e.varInfo,e.errors&&0!==e.errors.length)this.codeErrors=e.errors;else try{var t=this,o=function(){return t.memberFunctionInitialize()},a=new apogee.action.Messenger(this),n=e.generatorFunction(o,a);this.memberFunction=n.memberFunction,this.memberFunctionInitializer=n.initializer,this.codeErrors=[]}catch(e){this.codeErrors.push(apogee.ActionError.processException(e,"Codeable - Set Code",!1))}this.codeErrors.length>0&&(this.memberFunction=null,this.memberFunctionInitializer=null),this.codeSet=!0},apogee.Codeable.initializeDependencies=function(){if(this.hasCode()&&this.varInfo&&0===this.codeErrors.length)try{var e=apogee.codeDependencies.getDependencyInfo(this.varInfo,this.getContextManager());this.updateDependencies(e)}catch(e){this.codeErrors.push(apogee.ActionError.processException(e,"Codeable - Set Dependencies",!1))}else this.updateDependencies([])},apogee.Codeable.updateDependeciesForModelChange=function(e){if(this.hasCode()&&this.varInfo){var t=apogee.codeDependencies.getDependencyInfo(this.varInfo,this.getContextManager());this.updateDependencies(t)&&apogee.calculation.addToRecalculateList(e,this)}},apogee.Codeable.clearCode=function(){this.codeSet=!1,this.functionBody="",this.supplementalCode="",this.varInfo=null,this.dependencyInfo=null,this.memberFunctionInitializer=null,this.memberFunction=null,this.codeErrors=[],this.clearCalcPending(),this.setResultPending(!1);var e=[];this.updateDependencies(e)},apogee.Codeable.hasCode=function(){return this.codeSet},apogee.Codeable.needsCalculating=function(){return this.codeSet},apogee.Codeable.prepareForCalculate=function(){apogee.Dependent.prepareForCalculate.call(this),this.functionInitialized=!1,this.initReturnValue=!1},apogee.Codeable.calculate=function(){if(this.codeErrors.length>0)return this.addErrors(this.codeErrors),void this.clearCalcPending();if(!this.memberFunction||!this.memberFunctionInitializer){var e="Function not found for member: "+this.getName(),t=new apogee.ActionError(e,"Codeable - Calculate",this);return this.addError(t),void this.clearCalcPending()}try{this.processMemberFunction(this.memberFunction)}catch(e){if(e==apogee.Codeable.MEMBER_FUNCTION_PENDING)this.setResultPending(!0);else{e.stack&&console.error(e.stack);var o=e.message?e.message:"Unknown error";(t=new apogee.ActionError(o,"Codeable - Calculate",this)).setParentException(e),this.addError(t)}}this.clearCalcPending()},apogee.Codeable.memberFunctionInitialize=function(){if(this.functionInitialized)return this.initReturnValue;if(this.calcInProgress){var e="Circular reference error",t=new apogee.ActionError(e,"Codeable - Calculate",this);return this.addError(t),this.calcInProgress=!1,this.functionInitialized=!0,this.initReturnValue=!1,this.initReturnValue}this.calcInProgress=!0;try{if(this.initializeImpactors(),this.hasError()||this.getResultPending())return this.calcInProgress=!1,this.functionInitialized=!0,this.initReturnValue=!1,this.initReturnValue;this.memberFunctionInitializer(this.getContextManager()),this.initReturnValue=!0}catch(o){o.stack&&console.error(o.stack);e=o.message?o.message:"Unknown error";(t=new apogee.ActionError(e,"Codeable - Calculate",this)).setParentException(o),this.addError(t),this.initReturnValue=!1}finally{this.postInitializeAction&&this.postInitializeAction()}return this.calcInProgress=!1,this.functionInitialized=!0,this.initReturnValue},apogee.Codeable.getUpdateData=function(){var e={};return this.hasCode()?(e.argList=this.getArgList(),e.functionBody=this.getFunctionBody(),e.supplementalCode=this.getSupplementalCode()):e.data=this.getData(),e.description=this.getDescription(),e},apogee.Codeable.createContextManager=function(){return new apogee.ContextManager(this)},apogee.Owner={},apogee.Owner.init=function(){},apogee.Owner.isOwner=!0,apogee.Owner.getMemberByFullName=function(e){var t=e.split(".");return this.getMemberByPathArray(t)},apogee.Parent={},apogee.Parent.ROOT_NAME="root",apogee.Parent.init=function(){},apogee.Parent.isParent=!0,apogee.Parent.isRoot=function(){return null==this.getParent()},apogee.Parent.lookupChildFromPathArray=function(e,t){void 0===t&&(t=0);var o=this.lookupChild(e[t]);if(o)return t<e.length-1?o.isParent?o.lookupChildFromPathArray(e,t+1):o.isOwner?o.getMemberByPathArray(e,t+1):o:o},apogee.Parent.createContextManager=function(){var e=new apogee.ContextManager(this),t={};return t.parent=this,e.addToContextList(t),e},apogee.Parent.getPossesionNameBase=function(){return this.getFullName()+"."},apogee.RootHolder={},apogee.RootHolder.init=function(){},apogee.RootHolder.isRootHolder=!0,apogee.Workspace=function(e,t,o){apogee.EventManager.init.call(this),apogee.ContextHolder.init.call(this),apogee.Owner.init.call(this),apogee.RootHolder.init.call(this),this.isDirty=!1,this.actionInProgress=!1,this.actionQueue=[],this.name=apogee.Workspace.DEFAULT_WORKSPACE_NAME,void 0===o&&(o=null),this.owner=o,e?this.loadFromJson(e,t):this.rootFolder=new apogee.Folder(apogee.Workspace.ROOT_FOLDER_NAME,this)},apogee.base.mixin(apogee.Workspace,apogee.EventManager),apogee.base.mixin(apogee.Workspace,apogee.ContextHolder),apogee.base.mixin(apogee.Workspace,apogee.Owner),apogee.base.mixin(apogee.Workspace,apogee.RootHolder),apogee.Workspace.DEFAULT_WORKSPACE_NAME="Workspace",apogee.Workspace.ROOT_FOLDER_NAME="Model",apogee.Workspace.prototype.setIsDirty=function(){this.isDirty=!0},apogee.Workspace.prototype.getIsDirty=function(){return this.isDirty},apogee.Workspace.prototype.clearIsDirty=function(){this.isDirty=!1},apogee.Workspace.prototype.setName=function(e){this.name=e},apogee.Workspace.prototype.getName=function(){return this.name},apogee.Workspace.prototype.getRoot=function(){return this.rootFolder},apogee.Workspace.prototype.setRoot=function(e){this.rootFolder=e},apogee.Workspace.prototype.getOwner=function(){return this.owner},apogee.Workspace.prototype.updateDependeciesForModelChange=function(e){this.rootFolder&&this.rootFolder.updateDependeciesForModelChange(e)},apogee.Workspace.prototype.onClose=function(){this.rootFolder.onClose()},apogee.Workspace.prototype.isActionInProgress=function(){return this.actionInProgress},apogee.Workspace.prototype.setActionInProgress=function(e){this.actionInProgress=e},apogee.Workspace.prototype.queueAction=function(e){this.actionQueue.push(e)},apogee.Workspace.prototype.getQueuedAction=function(){if(this.actionQueue.length>0){var e=this.actionQueue[0];return this.actionQueue.splice(0,1),e}return null},apogee.Workspace.prototype.getWorkspace=function(){return this},apogee.Workspace.prototype.getPossesionNameBase=function(){return""},apogee.Workspace.prototype.getMemberByPathArray=function(e,t){return void 0===t&&(t=0),e[t]===this.rootFolder.getName()?t===e.length-1?this.rootFolder:(t++,this.rootFolder.lookupChildFromPathArray(e,t)):null},apogee.Workspace.prototype.createContextManager=function(){var e=new apogee.ContextManager(this);if(this.owner)apogee.Workspace.flattenParentIntoContextManager(e,this.owner);else{var t={};t.data=__globals__,e.addToContextList(t)}return e},apogee.Workspace.createVirtualWorkpaceFromFolder=function(e,t,o){var a={};return a.fileType=apogee.Workspace.SAVE_FILE_TYPE,a.version=apogee.Workspace.SAVE_FILE_VERSION,a.data=t.toJson(),new apogee.Workspace(a,null,o)},apogee.Workspace.flattenParentIntoContextManager=function(e,t){for(var o=t;null!=o;o=o.getOwner())for(var a=o.getContextManager().contextList,n=0;n<a.length;n++){var r=a[n];r.parent?e.addToContextList(apogee.Workspace.convertToDataContextEntry(r)):r.data&&e.addToContextList(r)}},apogee.Workspace.convertToDataContextEntry=function(e){var t={};return t.data=e.parent.getData(),t},apogee.Workspace.SAVE_FILE_TYPE="apogee workspace",apogee.Workspace.SAVE_FILE_VERSION=.2,apogee.Workspace.prototype.toJson=function(e){var t={};t.fileType=apogee.Workspace.SAVE_FILE_TYPE,t.version=apogee.Workspace.SAVE_FILE_VERSION,t.name=this.name;var o;return o=e||this.rootFolder,t.data=o.toJson(),t},apogee.Workspace.prototype.loadFromJson=function(e,t){if(e.fileType!==apogee.Workspace.SAVE_FILE_TYPE)throw apogee.base.createError("Bad file format.",!1);if(e.version!==apogee.Workspace.SAVE_FILE_VERSION)throw apogee.base.createError("Incorrect file version. CHECK APOGEEJS.COM FOR VERSION CONVERTER.",!1);t||(t=new apogee.ActionResponse),void 0!==e.name&&(this.name=e.name);var o=e.data;return o.action="createMember",o.owner=this,o.workspace=this,apogee.action.doAction(o,!1,t),t},apogee.Workspace.memberGenerators={},apogee.Workspace.getMemberGenerator=function(e){return apogee.Workspace.memberGenerators[e]},apogee.Workspace.addMemberGenerator=function(e){apogee.Workspace.memberGenerators[e.type]=e},apogee.JsonTable=function(e,t,o){apogee.Member.init.call(this,e,apogee.JsonTable.generator),apogee.Dependent.init.call(this),apogee.ContextHolder.init.call(this),apogee.Codeable.init.call(this,[],!0),this.initOwner(t),o||((o={}).data=""),void 0!==o.functionBody?apogee.updatemember.applyCode(this,o.argList,o.functionBody,o.supplementalCode):(void 0===o.data&&(o.data=""),apogee.updatemember.applyData(this,o.data)),void 0!==o.description&&this.setDescription(o.description)},apogee.base.mixin(apogee.JsonTable,apogee.Member),apogee.base.mixin(apogee.JsonTable,apogee.Dependent),apogee.base.mixin(apogee.JsonTable,apogee.ContextHolder),apogee.base.mixin(apogee.JsonTable,apogee.Codeable),apogee.JsonTable.prototype.getArgList=function(){return[]},apogee.JsonTable.prototype.processMemberFunction=function(e){var t=e();if(apogee.base.isPromise(t)){var o=apogee.action.getAsynchToken();this.setResultPending(!0,o);var a=this,n=function(e){var t={};t.action="asynchFormulaData",t.member=a,t.token=o,t.data=e;apogee.action.doAction(t,!1)},r=function(e){var t={};t.action="updateError",t.member=a,t.token=o,t.errorMsg=e;apogee.action.doAction(t,!1)};t.then(n).catch(r)}else this.setData(t)},apogee.JsonTable.prototype.setData=function(e){return apogee.base.deepFreeze(e),apogee.Member.setData.call(this,e)},apogee.JsonTable.fromJson=function(e,t){return new apogee.JsonTable(t.name,e,t.updateData)},apogee.JsonTable.generator={},apogee.JsonTable.generator.displayName="Table",apogee.JsonTable.generator.type="apogee.JsonTable",apogee.JsonTable.generator.createMember=apogee.JsonTable.fromJson,apogee.JsonTable.generator.setDataOk=!0,apogee.JsonTable.generator.setCodeOk=!0,apogee.Workspace.addMemberGenerator(apogee.JsonTable.generator),apogee.FunctionTable=function(e,t,o){apogee.Member.init.call(this,e,apogee.FunctionTable.generator),apogee.Dependent.init.call(this),apogee.ContextHolder.init.call(this),apogee.Codeable.init.call(this,a,!1),this.initOwner(t);var a=o.argList?o.argList:[],n=o.functionBody?o.functionBody:"",r=o.supplementalCode?o.supplementalCode:"";apogee.updatemember.applyCode(this,a,n,r),void 0!==o.description&&this.setDescription(o.description)},apogee.base.mixin(apogee.FunctionTable,apogee.Member),apogee.base.mixin(apogee.FunctionTable,apogee.Dependent),apogee.base.mixin(apogee.FunctionTable,apogee.ContextHolder),apogee.base.mixin(apogee.FunctionTable,apogee.Codeable),apogee.FunctionTable.prototype.processMemberFunction=function(e){this.setData(e)},apogee.FunctionTable.prototype.postInitializeAction=function(){if(this.getResultPending())throw apogee.Codeable.MEMBER_FUNCTION_PENDING},apogee.FunctionTable.prototype.getDisplayName=function(e){return(e?this.getFullName():this.getName())+"("+this.getArgList().join(",")+")"},apogee.FunctionTable.fromJson=function(e,t){return new apogee.FunctionTable(t.name,e,t.updateData)},apogee.FunctionTable.addPropValues=function(e,t){var o=e.getArgList().toString();return t.argListString=o,t},apogee.FunctionTable.getPropertyUpdateAction=function(e,t,o){if(t.argListString!==o.argListString){var a=apogee.FunctionTable.parseStringArray(o.argListString),n={};return n.action="updateCode",n.member=e,n.argList=a,n.functionBody=e.getFunctionBody(),n.supplementalCode=e.getSupplementalCode(),n}return null},apogee.FunctionTable.parseStringArray=function(e){for(var t=e.split(","),o=0;o<t.length;o++)t[o]=t[o].trim();return t},apogee.FunctionTable.generator={},apogee.FunctionTable.generator.displayName="Function",apogee.FunctionTable.generator.type="apogee.FunctionTable",apogee.FunctionTable.generator.createMember=apogee.FunctionTable.fromJson,apogee.FunctionTable.generator.addPropFunction=apogee.FunctionTable.addPropValues,apogee.FunctionTable.generator.getPropertyUpdateAction=apogee.FunctionTable.getPropertyUpdateAction,apogee.FunctionTable.generator.setDataOk=!1,apogee.FunctionTable.generator.setCodeOk=!0,apogee.Workspace.addMemberGenerator(apogee.FunctionTable.generator),apogee.Folder=function(e,t){apogee.Member.init.call(this,e,apogee.Folder.generator),apogee.Dependent.init.call(this),apogee.ContextHolder.init.call(this),apogee.Owner.init.call(this),apogee.Parent.init.call(this),this.initOwner(t),this.childMap={},this.dataMap={},Object.freeze(this.dataMap),this.setData(this.dataMap)},apogee.base.mixin(apogee.Folder,apogee.Member),apogee.base.mixin(apogee.Folder,apogee.Dependent),apogee.base.mixin(apogee.Folder,apogee.ContextHolder),apogee.base.mixin(apogee.Folder,apogee.Owner),apogee.base.mixin(apogee.Folder,apogee.Parent),apogee.Folder.prototype.getChildMap=function(){return this.childMap},apogee.Folder.prototype.lookupChild=function(e){return this.childMap[e]},apogee.Folder.prototype.addChild=function(e){var t=e.getName();if(this.childMap[t])throw apogee.base.createError("There is already an object with the given name.",!1);this.childMap[t]=e;var o=e.getData();void 0!==o&&this.spliceDataMap(t,o),this.calculateDependents()},apogee.Folder.prototype.removeChild=function(e){var t=e.getParent();if(t&&t===this){var o=e.getName();delete this.childMap[o],this.spliceDataMap(o),this.calculateDependents()}},apogee.Folder.prototype.updateData=function(e){var t=e.getName(),o=e.getData();void 0!==this.childMap[t]?this.spliceDataMap(t,o):alert("Error - this table "+t+" has not yet been added to the folder.")},apogee.Folder.prototype.needsCalculating=function(){return!0},apogee.Folder.prototype.calculate=function(){this.initializeImpactors(),this.clearCalcPending()},apogee.Folder.prototype.updateDependeciesForModelChange=function(e){for(var t in this.childMap){var o=this.childMap[t];o.isDependent&&o.updateDependeciesForModelChange(e)}},apogee.Folder.fromJson=function(e,t,o){var a=new apogee.Folder(t.name,e);for(var n in t.children){var r=t.children[n];o.push(r)}return a},apogee.Folder.prototype.addToJson=function(e){e.children={};for(var t in this.childMap){var o=this.childMap[t];e.children[t]=o.toJson()}},apogee.Folder.prototype.onClose=function(){for(var e in this.childMap){var t=this.childMap[e];t.onClose&&t.onClose()}},apogee.Folder.prototype.calculateDependents=function(){var e=[];for(var t in this.childMap){var o=this.childMap[t];e.push(o)}this.updateDependencies(e)},apogee.Folder.prototype.spliceDataMap=function(e,t){var o={};for(var a in this.dataMap)a!==e&&(o[a]=this.dataMap[a]);void 0!==t&&(o[e]=t),Object.freeze(o),this.dataMap=o,this.setData(this.dataMap)},apogee.Folder.generator={},apogee.Folder.generator.displayName="Folder",apogee.Folder.generator.type="apogee.Folder",apogee.Folder.generator.createMember=apogee.Folder.fromJson,apogee.Folder.generator.setDataOk=!1,apogee.Folder.generator.setCodeOk=!1,apogee.Workspace.addMemberGenerator(apogee.Folder.generator),apogee.FolderFunction=function(e,t,o,a){if(apogee.Member.init.call(this,e,apogee.FolderFunction.generator),apogee.Dependent.init.call(this),apogee.ContextHolder.init.call(this),apogee.Owner.init.call(this),apogee.RootHolder.init.call(this),this.initOwner(t),this.argList=void 0!==o.argList?o.argList:"",this.returnValueString=void 0!==o.returnValue?o.returnValue:[],this.setData(function(){}),a){var n=new apogee.Folder(apogee.FolderFunction.INTERNAL_FOLDER_NAME,this);this.setRoot(n)}},apogee.base.mixin(apogee.FolderFunction,apogee.Member),apogee.base.mixin(apogee.FolderFunction,apogee.Dependent),apogee.base.mixin(apogee.FolderFunction,apogee.ContextHolder),apogee.base.mixin(apogee.FolderFunction,apogee.Owner),apogee.base.mixin(apogee.FolderFunction,apogee.RootHolder),apogee.FolderFunction.INTERNAL_FOLDER_NAME="root",apogee.FolderFunction.prototype.getInternalFolder=function(){return this.internalFolder},apogee.FolderFunction.prototype.getRoot=function(){return this.getInternalFolder()},apogee.FolderFunction.prototype.setRoot=function(e){this.internalFolder=e;var t=[];e&&t.push(e),this.updateDependencies(t)},apogee.FolderFunction.prototype.getReturnValueString=function(){return this.returnValueString},apogee.FolderFunction.prototype.getArgList=function(){return this.argList},apogee.FolderFunction.prototype.getDisplayName=function(e){var t=(e?this.getFullName():this.getName())+"("+this.getArgList().join(",")+")";return null!=this.returnValueString&&this.returnValueString.length>0&&(t+=" = "+this.returnValueString),t},apogee.FolderFunction.prototype.close=function(){this.internalFolder.onClose()},apogee.FolderFunction.fromJson=function(e,t,o){var a={};a.argList=t.argList,a.returnValue=t.returnValue;var n;return t.internalFolder?(t.internalFolder.name=apogee.FolderFunction.INTERNAL_FOLDER_NAME,o.push(t.internalFolder),n=!1):n=!0,new apogee.FolderFunction(t.name,e,a,n)},apogee.FolderFunction.prototype.addToJson=function(e){e.argList=this.argList,e.returnValue=this.returnValueString,e.internalFolder=this.internalFolder.toJson()},apogee.FolderFunction.addPropValues=function(e,t){var o=e.getArgList().toString();return t.argListString=o,t.returnValueString=e.getReturnValueString(),t},apogee.FolderFunction.getPropertyUpdateAction=function(e,t,o){if(t.argListString!==o.argListString||t.returnValueString!==o.returnValueString){var a=apogee.FunctionTable.parseStringArray(o.argListString),n={};return n.action="updateFolderFunction",n.member=e,n.argList=a,n.returnValueString=o.returnValueString,n}return null},apogee.FolderFunction.prototype.needsCalculating=function(){return!0},apogee.FolderFunction.prototype.calculate=function(){this.initializeImpactors();var e=[],t=this.getFolderFunctionFunction(e);0==e.length?this.setData(t):this.addErrors(e),this.clearCalcPending()},apogee.FolderFunction.prototype.updateDependeciesForModelChange=function(e){this.internalFolder&&this.internalFolder.updateDependeciesForModelChange(e)},apogee.FolderFunction.prototype.createContextManager=function(){return new apogee.ContextManager(this)},apogee.FolderFunction.prototype.getChildMap=function(){return this.internalFolder.childMap},apogee.FolderFunction.prototype.lookupChild=function(e){return this.internalFolder.childMap[e]},apogee.FolderFunction.prototype.getPossesionNameBase=function(){return this.getFullName()+"."},apogee.FolderFunction.prototype.getMemberByPathArray=function(e,t){return void 0===t&&(t=0),e[t]===this.internalFolder.getName()?t===e.length-1?this.internalFolder:(t++,this.internalFolder.lookupChildFromPathArray(e,t)):null},apogee.FolderFunction.prototype.setReturnValueString=function(e){this.returnValueString=e},apogee.FolderFunction.prototype.setArgList=function(e){this.argList=e},apogee.FolderFunction.prototype.getFolderFunctionFunction=function(e){var t,o,a,n,r=!1,i=this;return function(p){if(!r){if(!(t=i.createVirtualWorkspace(e)))return null;o=t.getRoot(),a=i.loadInputElements(o,e),n=i.loadOutputElement(o,e),r=!0}for(var s=[],c=0;c<a.length;c++){var l={};l.action="updateData",l.member=a[c],l.data=arguments[c],s.push(l)}var g={};g.action="compoundAction",g.actions=s,g.workspace=t;var d=apogee.action.doAction(g,!1);if(!d.getSuccess())throw apogee.base.createError(d.getErrorMsg());if(n){if(n.getResultPending())throw new Error("A folder function must not be asynchronous: "+i.getFullName());return n.getData()}}},apogee.FolderFunction.prototype.createVirtualWorkspace=function(e){try{return apogee.Workspace.createVirtualWorkpaceFromFolder(this.getName(),this.internalFolder,this.getOwner())}catch(o){var t=apogee.ActionError.processException(exception,"FolderFunction - Code",!1);return e.push(t),null}},apogee.FolderFunction.prototype.loadInputElements=function(e,t){for(var o=[],a=0;a<this.argList.length;a++){var n=this.argList[a],r=e.lookupChild(n);r&&o.push(r)}return o},apogee.FolderFunction.prototype.loadOutputElement=function(e,t){return e.lookupChild(this.returnValueString)},apogee.FolderFunction.generator={},apogee.FolderFunction.generator.displayName="Folder Function",apogee.FolderFunction.generator.type="apogee.FolderFunction",apogee.FolderFunction.generator.createMember=apogee.FolderFunction.fromJson,apogee.FolderFunction.generator.addPropFunction=apogee.FolderFunction.addPropValues,apogee.FolderFunction.generator.getPropertyUpdateAction=apogee.FolderFunction.getPropertyUpdateAction,apogee.FolderFunction.generator.setDataOk=!1,apogee.FolderFunction.generator.setCodeOk=!1,apogee.Workspace.addMemberGenerator(apogee.FolderFunction.generator),apogee.action={},apogee.action.actionInfo={},apogee.action.doAction=function(e,t,o,a){var n;if(e.member)n=e.member.getWorkspace();else{if(!e.workspace)throw new Error("Workspace info missing from action. ");n=e.workspace}if(n.isActionInProgress()){var r={};return r.actionData=e,r.optionalContext=o,r.optionalActionResponse=a,r.addToUndo=t,n.queueAction(r),new apogee.ActionResponse}n.setActionInProgress(!0);var i=a||new apogee.ActionResponse;try{var p=[];apogee.action.callActionFunction(e,o,p);var s=[];apogee.action.handleMissingMember(p,i),apogee.action.updateDependencies(n,p,s),apogee.action.updateRecalculateList(p,s),apogee.calculation.callRecalculateList(s,i),apogee.action.fireEvents(n,p,s),t&&n.setIsDirty()}catch(e){var c=apogee.ActionError.processException(e,apogee.ActionError.ERROR_TYPE_APP,!0);i.addError(c)}n.setActionInProgress(!1);var l=n.getQueuedAction();return l&&apogee.action.asynchRunQueuedAction(l),i},apogee.action.addActionInfo=function(e,t){apogee.action.actionInfo[e]=t},apogee.action.callActionFunction=function(e,t,o){var a=apogee.action.actionInfo[e.action];a?(e.actionInfo=a,a.actionFunction(e,t,o)):e.error=new apogee.ActionError("Unknown action: "+e.action,apogee.ActionError.ERROR_TYPE_APP,null)},apogee.action.getAsynchToken=function(){return Math.random()},apogee.action.DEPENDENT_PENDING_TOKEN=-1,apogee.action.dataUpdate=function(e,t,o,a){var n=t.getWorkspace(),r=t.getContextManager(),i={};return i.action="updateData",i.memberName=e,i.workspace=n,i.data=o,apogee.action.doAction(i,a,r)},apogee.action.compoundDataUpdate=function(e,t,o){var a=t.getWorkspace(),n=t.getContextManager(),r={};return r.action=apogee.compoundaction.ACTION_NAME,r.actions=apogee.action.updateInfoToActionList(e,a),r.workspace=a,apogee.action.doAction(r,o,n)},apogee.action.errorUpdate=function(e,t,o,a){var n=t.getWorkspace(),r=t.getContextManager(),i={};return i.action="updateError",i.memberName=e,i.workspace=n,i.errorMsg=o,apogee.action.doAction(i,a,r)},apogee.action.asynchDataUpdate=function(e,t,o,a){var n=t.getWorkspace(),r=t.getContextManager(),i=apogee.action.getAsynchToken(),p={};p.action="updateDataPending",p.memberName=e,p.workspace=n,p.token=i;apogee.action.doAction(p,a,r);o.then(function(t){var o={};o.action="updateData",o.memberName=e,o.workspace=n,o.token=i,o.data=t;apogee.action.doAction(o,a,r)}).catch(function(t){var o={};o.action="updateError",o.memberName=e,o.workspace=n,o.token=i,o.errorMsg=t;apogee.action.doAction(o,a,r)})},apogee.action.updateInfoToActionList=function(e,t){for(var o=[],a=0;a<e.length;a++){var n=e[a],r={};r.action="updateData",r.memberName=n[0],r.workspace=t,r.data=n[1],o.push(r)}return o},apogee.action.asynchRunQueuedAction=function(e){setTimeout(function(){apogee.action.doAction(e.actionData,e.addToUndo,e.optionalContext,e.optionalActionResponse)},0)},apogee.action.handleMissingMember=function(e,t){e.filter(e=>void 0==e.member).forEach(e=>{e.error&&t.addError(e.error)})},apogee.action.updateDependencies=function(e,t,o){if(apogee.action.checkUpdateAllDep(t))e.updateDependeciesForModelChange(o);else for(var a=0;a<t.length;a++){var n=t[a];apogee.action.doInitializeDependencies(n)&&n.member.initializeDependencies()}},apogee.action.updateRecalculateList=function(e,t){for(var o=0;o<e.length;o++){var a=e[o];apogee.action.doAddToRecalc(a)?apogee.calculation.addToRecalculateList(t,a.member):apogee.action.doAddDependOnToRecalc(a)&&apogee.calculation.addDependsOnToRecalculateList(t,a.member)}},apogee.action.fireEvents=function(e,t,o){for(var a={},n=0;n<t.length;n++){var r=t[n];if(r.actionInfo){var i=r.actionInfo.event;if(!i)continue;var p=r.member;apogee.action.fireEvent(e,i,p),p&&(a[r.member.getId()]=!0)}}for(n=0;n<o.length;n++)a[(p=o[n]).getId()]||apogee.action.fireEvent(e,apogee.updatemember.MEMBER_UPDATED_EVENT,p)},apogee.action.fireEvent=function(e,t,o){e.dispatchEvent(t,o)},apogee.action.checkUpdateAllDep=function(e){for(var t=0;t<e.length;t++){var o=e[t];if(o.member&&o.actionInfo&&o.actionInfo.checkUpdateAll)return!0}return!1},apogee.action.doInitializeDependencies=function(e){return!!e.member&&(!!e.actionInfo&&e.actionInfo.updateDependencies)},apogee.action.doAddToRecalc=function(e){return!!e.member&&(!!e.actionInfo&&e.actionInfo.addToRecalc)},apogee.action.doAddDependOnToRecalc=function(e){return!!e.actionInfo&&e.actionInfo.addDependenceiesToRecalc},apogee.compoundaction={},apogee.compoundaction.ACTION_NAME="compoundAction",apogee.compoundaction.compoundActionFunction=function(e,t,o){for(var a=e.actions,n=0;n<a.length;n++){var r=a[n];apogee.action.callActionFunction(r,t,o)}},apogee.compoundaction.ACTION_INFO={actionFunction:apogee.compoundaction.compoundActionFunction,checkUpdateAll:!1,updateDependencies:!1,addToRecalc:!1,event:null},apogee.action.addActionInfo(apogee.compoundaction.ACTION_NAME,apogee.compoundaction.ACTION_INFO),apogee.createmember={},apogee.createmember.ACTION_NAME="createMember",apogee.createmember.MEMBER_CREATED_EVENT="memberCreated",apogee.createmember.createMember=function(e,t,o){var a=apogee.Workspace.getMemberGenerator(e.type);if(!a)return e.error=new apogee.ActionError("Member type not found: "+e.type,apogee.ActionError.ERROR_TYPE_APP,null),o.push(e),null;var n=[],r=a.createMember(e.owner,e,n);e.member=r,o.push(e);for(var i=0;i<n.length;i++){var p=n[i];p.action="createMember",p.actionInfo=e.actionInfo,p.owner=r,apogee.createmember.createMember(p,t,o)}return r},apogee.createmember.ACTION_INFO={actionFunction:apogee.createmember.createMember,checkUpdateAll:!0,updateDependencies:!0,addToRecalc:!0,event:apogee.createmember.MEMBER_CREATED_EVENT},apogee.action.addActionInfo(apogee.createmember.ACTION_NAME,apogee.createmember.ACTION_INFO),apogee.updateworkspace={},apogee.updateworkspace.UPDATE_WORKSPACE_ACTION_NAME="updateWorkspace",apogee.updateworkspace.WORKSPACE_UPDATED_EVENT="workspaceUpdated",apogee.updateworkspace.updateWorkspace=function(e,t,o){e.workspace.setName(e.name),o.push(e)},apogee.updateworkspace.UPDATE_WORKSPACE_ACTION_INFO={actionFunction:apogee.updateworkspace.updateWorkspace,checkUpdateAll:!1,updateDependencies:!1,addToRecalc:!1,addDependenceiesToRecalc:!1,event:apogee.updateworkspace.WORKSPACE_UPDATED_EVENT},apogee.action.addActionInfo(apogee.updateworkspace.UPDATE_WORKSPACE_ACTION_NAME,apogee.updateworkspace.UPDATE_WORKSPACE_ACTION_INFO),apogee.updatemember={},apogee.updatemember.UPDATE_DATA_ACTION_NAME="updateData",apogee.updatemember.UPDATE_CODE_ACTION_NAME="updateCode",apogee.updatemember.UPDATE_DATA_PENDING_ACTION_NAME="updateDataPending",apogee.updatemember.UPDATE_ASYNCH_DATA_ACTION_NAME="asynchFormulaData",apogee.updatemember.UPDATE_ASYNCH_ERROR_ACTION_NAME="updateError",apogee.updatemember.UPDATE_DESCRIPTION_ACTION_NAME="updateDescription",apogee.updatemember.MEMBER_UPDATED_EVENT="memberUpdated",apogee.updatemember.updateCode=function(e,t,o){if(!e.member.getSetCodeOk())throw new Error("can not set code on member: "+member.getFullName());apogee.updatemember.applyCode(e.member,e.argList,e.functionBody,e.supplementalCode),o.push(e)},apogee.updatemember.updateData=function(e,t,o){if(e.member||apogee.updatemember.loadMemberName(e,t),!e.member.getSetDataOk())throw new Error("can not set data on member: "+a.getFullName());var a=e.member;apogee.updatemember.applyData(a,e.data),a.isCodeable&&a.clearCode(),o.push(e)},apogee.updatemember.updateDataPending=function(e,t,o){e.member||apogee.updatemember.loadMemberName(e,t);var a=e.member,n=e.token;a.setResultPending(!0,n),o.push(e)},apogee.updatemember.asynchFunctionUpdateData=function(e,t,o){if(!e.member.getSetCodeOk())throw new Error("can not set code on member: "+a.getFullName());var a=e.member,n=e.token;a.pendingTokenMatches(n)&&(apogee.updatemember.applyData(a,e.data),a.setResultPending(!1),o.push(e))},apogee.updatemember.asynchFunctionUpdateError=function(e,t,o){e.member||apogee.updatemember.loadMemberName(e,t);var a=e.member,n=e.token;if(a.pendingTokenMatches(n)){var r=new apogee.ActionError(e.errorMsg,"Codeable - Calculate",a);a.addError(r),a.setResultPending(!1),o.push(e)}},apogee.updatemember.updateDescription=function(e,t,o){e.member.setDescription(e.description),o.push(e)},apogee.updatemember.applyCode=function(e,t,o,a){var n={};n.argList=t,n.functionBody=o,n.supplementalCode=a;var r=e.getFullName();apogee.codeCompiler.processCode(n,r),e.setCodeInfo(n)},apogee.updatemember.applyData=function(e,t){e.clearErrors(),e.setData(t)},apogee.updatemember.loadMemberName=function(e,t){if(e.memberName){var o=e.memberName.split(".");e.member=t.getImpactor(o)}if(!e.member)throw new Error("Member not found for action: "+e.action)},apogee.updatemember.UPDATE_DATA_ACTION_INFO={actionFunction:apogee.updatemember.updateData,checkUpdateAll:!1,updateDependencies:!0,addToRecalc:!1,addDependenceiesToRecalc:!0,event:apogee.updatemember.MEMBER_UPDATED_EVENT},apogee.updatemember.UPDATE_CODE_ACTION_INFO={actionFunction:apogee.updatemember.updateCode,checkUpdateAll:!1,updateDependencies:!0,addToRecalc:!0,event:apogee.updatemember.MEMBER_UPDATED_EVENT},apogee.updatemember.UPDATE_DATA_PENDING_ACTION_INFO={actionFunction:apogee.updatemember.updateDataPending,checkUpdateAll:!1,updateDependencies:!0,addToRecalc:!1,addDependenceiesToRecalc:!0,event:apogee.updatemember.MEMBER_UPDATED_EVENT},apogee.updatemember.UPDATE_ASYNCH_DATA_ACTION_INFO={actionFunction:apogee.updatemember.asynchFunctionUpdateData,checkUpdateAll:!1,updateDependencies:!1,addToRecalc:!1,addDependenceiesToRecalc:!0,event:apogee.updatemember.MEMBER_UPDATED_EVENT},apogee.updatemember.UPDATE_ASYNCH_ERROR_ACTION_INFO={actionFunction:apogee.updatemember.asynchFunctionUpdateError,checkUpdateAll:!1,updateDependencies:!1,addToRecalc:!1,addDependenceiesToRecalc:!0,event:apogee.updatemember.MEMBER_UPDATED_EVENT},apogee.updatemember.UPDATE_DESCRIPTION_ACTION_INFO={actionFunction:apogee.updatemember.updateDescription,checkUpdateAll:!1,updateDependencies:!1,addToRecalc:!1,addDependenceiesToRecalc:!1,event:apogee.updatemember.MEMBER_UPDATED_EVENT},apogee.action.addActionInfo(apogee.updatemember.UPDATE_DATA_ACTION_NAME,apogee.updatemember.UPDATE_DATA_ACTION_INFO),apogee.action.addActionInfo(apogee.updatemember.UPDATE_CODE_ACTION_NAME,apogee.updatemember.UPDATE_CODE_ACTION_INFO),apogee.action.addActionInfo(apogee.updatemember.UPDATE_DATA_PENDING_ACTION_NAME,apogee.updatemember.UPDATE_DATA_PENDING_ACTION_INFO),apogee.action.addActionInfo(apogee.updatemember.UPDATE_ASYNCH_DATA_ACTION_NAME,apogee.updatemember.UPDATE_ASYNCH_DATA_ACTION_INFO),apogee.action.addActionInfo(apogee.updatemember.UPDATE_ASYNCH_ERROR_ACTION_NAME,apogee.updatemember.UPDATE_ASYNCH_ERROR_ACTION_INFO),apogee.action.addActionInfo(apogee.updatemember.UPDATE_DESCRIPTION_ACTION_NAME,apogee.updatemember.UPDATE_DESCRIPTION_ACTION_INFO),apogee.movemember={},apogee.movemember.ACTION_NAME="moveMember",apogee.movemember.moveMember=function(e,t,o){var a=e.member,n=[];apogee.movemember.loadMovedList(a,n),a.move(e.name,e.owner);for(var r=0;r<n.length;r++){var i;n[r]===a?i=e:((i={}).action="moveMember",i.member=a,i.name=a.getName(),i.owner=a.getOwner(),i.actionInfo=e.actionInfo),o.push(i)}},apogee.movemember.loadMovedList=function(e,t){if(t.push(e),e.isParent){var o=e.getChildMap();for(var a in o){var n=o[a];apogee.movemember.loadMovedList(n,t)}}else if(e.isRootHolder){var r=e.getRoot();apogee.movemember.loadMovedList(r,t)}},apogee.movemember.ACTION_INFO={actionFunction:apogee.movemember.moveMember,checkUpdateAll:!0,updateDependencies:!0,addToRecalc:!0,event:apogee.updatemember.MEMBER_UPDATED_EVENT},apogee.action.addActionInfo(apogee.movemember.ACTION_NAME,apogee.movemember.ACTION_INFO),apogee.deletemember={},apogee.deletemember.ACTION_NAME="deleteMember",apogee.deletemember.MEMBER_DELETED_EVENT="memberDeleted",apogee.deletemember.deleteMember=function(e,t,o){var a=[];apogee.deletemember.getDeleteList(e.member,a);for(var n=0;n<a.length;n++){var r=a[n];r.onDeleteMember(),r.isDependent&&r.onDeleteDependent();var i;r==e.member?i=e:((i={}).action="deleteMember",i.member=r,i.actionInfo=e.actionInfo),o.push(i)}},apogee.deletemember.getDeleteList=function(e,t){if(e.isParent){var o=e.getChildMap();for(var a in o){var n=o[a];apogee.deletemember.getDeleteList(n,t)}}else if(e.isRootHolder){var r=e.getRoot();apogee.deletemember.getDeleteList(r,t)}t.push(e)},apogee.deletemember.ACTION_INFO={actionFunction:apogee.deletemember.deleteMember,checkUpdateAll:!0,updateDependencies:!1,addToRecalc:!1,event:apogee.deletemember.MEMBER_DELETED_EVENT},apogee.action.addActionInfo(apogee.deletemember.ACTION_NAME,apogee.deletemember.ACTION_INFO),apogee.updatefolderfunction={},apogee.updatefolderfunction.ACTION_NAME="updateFolderFunction",apogee.updatefolderfunction.updateProperties=function(e,t,o){var a=e.member;a.setArgList(e.argList),a.setReturnValueString(e.returnValueString),o.push(e)},apogee.updatefolderfunction.ACTION_INFO={actionFunction:apogee.updatefolderfunction.updateProperties,checkUpdateAll:!1,updateDependencies:!1,addToRecalc:!0,event:apogee.updatemember.MEMBER_UPDATED_EVENT},apogee.action.addActionInfo(apogee.updatefolderfunction.ACTION_NAME,apogee.updatefolderfunction.ACTION_INFO),apogee.action.Messenger=function(e){this.dataUpdate=function(t,o){apogee.action.dataUpdate(t,e,o,!1)},this.compoundDataUpdate=function(t){apogee.action.compoundDataUpdate(t,e,!1)},this.errorUpdate=function(t,o){apogee.action.errorUpdate(t,e,o,!1)},this.asynchDataUpdate=function(t,o){apogee.action.asynchDataUpdate(t,e,o,!1)}};