/*! apogee 0.4.1 */
var __globals__=window;apogee={},apogee.base={},apogee.base.mixin=function(a,b){for(var c in b)a.prototype[c]=b[c]},apogee.base.isPromise=function(a){return null!==a&&("object"==typeof a&&a.constructor===Promise)},apogee.base.deepFreeze=function(a){if(null!==a&&void 0!==a){var b,c=apogee.util.getObjectType(a);if("Object"==c){Object.freeze(a);for(b in a)apogee.base.deepFreeze(a[b])}else if("Array"==c)for(Object.freeze(a),b=0;b<a.length;b++)apogee.base.deepFreeze(a[b])}},apogee.base.createError=function(a,b,c){var d=new Error(a);return void 0!==b&&(d.isFatal=b),void 0!==c&&(d.baseError=c),d},apogee.base.getListInFirstButNotSecond=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];b.indexOf(e)<0&&c.push(e)}return c},apogee.util={},apogee.util.stringHash=function(a){for(var b,c=4294967295,d=0,e=0;e<a.length;e++)b=a.charCodeAt(e),d=31*d+b&c;return d},apogee.util.objectHash=function(a){var b=JSON.stringify(a);return stringHash(b)},apogee.util.constructors={String:"".constructor,Number:3..constructor,Boolean:(!0).constructor,Date:(new Date).constructor,Object:{}.constructor,Array:[].constructor,Function:function(){}.constructor},apogee.util.getObjectType=function(a){var b=a.constructor;for(var c in apogee.util.constructors)if(b==apogee.util.constructors[c])return c;return"Unknown"},apogee.util.deepJsonCopy=function(a){if(null===a)return null;if(void 0!==a)return JSON.parse(JSON.stringify(a))},apogee.util.formatString=function(a,b){var c=arguments;return a.replace(/{(\d+)}/g,function(a,b){var d=Number(b)+1;return c[d]})},apogee.util.readQueryField=function(a,b){var c=b?b:window.location.href,d=new RegExp("[?&]"+a+"=([^&#]*)","i"),e=d.exec(c);return e?e[1]:null},apogee.util.getNormalizedCopy=function(a){var b,c=apogee.util.getObjectType(a);switch(c){case"Object":b=apogee.util.getNormalizedObjectCopy(a);break;case"Array":b=apogee.util.getNormalizedArrayCopy(a);break;default:b=a}return b},apogee.util.getNormalizedObjectCopy=function(a){var b,c={},d=[];for(b in a)d.push(b);d.sort();for(var e=0;e<d.length;e++)b=d[e],c[b]=apogee.util.getNormalizedCopy(a[b]);return c},apogee.util.getNormalizedArrayCopy=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];b.push(apogee.util.getNormalizedCopy(d))}return b},apogee.net={},apogee.net.callbackRequest=function(a,b,c,d){var e=new XMLHttpRequest;e.onreadystatechange=function(){var a;if(4==e.readyState)if(200==e.status)try{b(e.responseText)}catch(d){c(d.message)}else e.status>=400?(a="Error in http request. Status: "+e.status,c(a)):0==e.status&&(a="Preflight error in request. See console",c(a))},d||(d={});var f=d.method?d.method:"GET";if(e.open(f,a,!0),d.header)for(var g in d.header)e.setRequestHeader(g,d.header[g]);e.send(d.body)},apogee.net.textRequest=function(a,b){return new Promise(function(c,d){apogee.net.callbackRequest(a,c,d,b)})},apogee.net.jsonRequest=function(a,b){return apogee.net.textRequest(a,b).then(JSON.parse)},apogee.EventManager={},apogee.EventManager.init=function(){this.listenerTable={},this.handlerTable={}},apogee.EventManager.addListener=function(a,b){var c=this.listenerTable[a];c||(c=[],this.listenerTable[a]=c);for(var d=0;d<c.length;d++){var e=c[d];if(e==b)return}c.push(b)},apogee.EventManager.removeListener=function(a,b){var c=this.listenerTable[a];if(c){var d=c.indexOf(b);d>=0&&c.splice(d,1)}},apogee.EventManager.dispatchEvent=function(a,b){var c=this.listenerTable[a];if(c)for(var d=0;d<c.length;d++){var e=c[d];e.call(null,b)}},apogee.EventManager.addHandler=function(a,b){this.handlerTable[a]=b},apogee.EventManager.removeHandler=function(a){delete this.handlerTable[a]},apogee.EventManager.callHandler=function(a,b){var c=this.handlerTable[a];return c?c(b):void 0},apogee.ContextManager=function(a){this.contextHolder=a,this.contextList=[]},apogee.ContextManager.prototype.addToContextList=function(a){this.contextList.push(a)},apogee.ContextManager.prototype.removeFromContextList=function(a){var b=this.contextList.indexOf(a);b>=0&&this.contextList.splice(b,1)},apogee.ContextManager.prototype.clearContextList=function(){this.contextList=[]},apogee.ContextManager.prototype.getBaseData=function(a){return this.hierarchicalLookup("lookupData",a)},apogee.ContextManager.prototype.getImpactor=function(a){return this.hierarchicalLookup("lookupImpactor",a)},apogee.ContextManager.prototype.hierarchicalLookup=function(a,b){var c=this.lookup(a,b);if(void 0!==c)return c;if(this.contextHolder&&this.contextHolder.getOwner){var d=this.contextHolder.getOwner();if(d){var e=d.getContextManager();return e.hierarchicalLookup(a,b)}}},apogee.ContextManager.prototype.lookup=function(a,b){for(var c=0;c<this.contextList.length;c++){var d=this.contextList[c],e=this[a](d,b);if(void 0!==e)return e}},apogee.ContextManager.prototype.lookupData=function(a,b){if(a.parent){var c=a.parent.lookupChild(b);return c?c.getData():void 0}if(a.data)return a.data[b]},apogee.ContextManager.prototype.lookupImpactor=function(a,b){return a.parent?a.parent.lookupChildFromPathArray(b):void 0},apogee.codeCompiler={},apogee.codeCompiler.APOGEE_FORBIDDEN_NAMES={apogeeMessenger:!0,__initFunction:!0,__memberFunction:!0,__memberFunctionDebugHook:!0},apogee.codeCompiler.NAME_PATTERN=/[a-zA-Z_$][0-9a-zA-Z_$]*/,apogee.codeCompiler.validateTableName=function(a){var b={};if(apogee.codeAnalysis.KEYWORDS[a])b.errorMessage="Illegal name: "+a+" - Javascript reserved keyword",b.valid=!1;else if(apogee.codeAnalysis.EXCLUSION_NAMES[a])b.errorMessage="Illegal name: "+a+" - Javascript variable or value name",b.valid=!1;else if(apogee.codeCompiler.APOGEE_FORBIDDEN_NAMES[a])b.errorMessage="Illegal name: "+a+" - Apogee reserved keyword",b.valid=!1;else{var b=apogee.codeCompiler.NAME_PATTERN.exec(a);b&&b[0]===a?b.valid=!0:(b.errorMessage="Illegal name format: "+a,b.valid=!1)}return b},apogee.codeCompiler.processCode=function(a,b){var c=apogee.codeCompiler.createCombinedFunctionBody(a.argList,a.functionBody,a.supplementalCode,b),d=apogee.codeCompiler.MEMBER_LOCALS_TEXT+c,e=apogee.codeAnalysis.analyzeCode(d);if(!e.success)return a.errors=e.errors,a;a.varInfo=e.varInfo;var f=apogee.codeCompiler.createGeneratorFunction(a.varInfo,c);return a.generatorFunction=f,a},apogee.codeCompiler.createCombinedFunctionBody=function(a,b,c,d){var e=a.join(","),f=apogee.util.formatString(apogee.codeCompiler.MEMBER_FUNCTION_FORMAT_TEXT,d,e,b,c);return f},apogee.codeCompiler.createGeneratorFunction=function(a,b){var c="",d="";for(var e in a){var f=a[e];"returnValue"===e||f.isLocal||(c+="var "+e+";\n",d+=e+' = contextManager.getBaseData("'+e+'");\n')}var g=apogee.util.formatString(apogee.codeCompiler.GENERATOR_FUNCTION_FORMAT_TEXT,c,d,b),h=new Function("__initFunction","apogeeMessenger",g);return h},apogee.codeCompiler.MEMBER_FUNCTION_FORMAT_TEXT=["//{0}","","//supplemental code--------------","{3}","//end supplemental code----------","","//member function----------------","function __memberFunction({1}) {","//overhead code","if(!__initFunction()) return undefined;","__memberFunctionDebugHook();","","//user code","{2}","};","//end member function------------"].join("\n"),apogee.codeCompiler.MEMBER_LOCALS_TEXT="var __initFunction, apogeeMessenger, __memberFunction, __memberFunctionDebugHook;",apogee.codeCompiler.GENERATOR_FUNCTION_FORMAT_TEXT=["'use strict'","//declare context variables","{0}","//context setter","function __initializer(contextManager) {","{1}};","","//user code","{2}","return {","'memberFunction': __memberFunction,","'initializer': __initializer","};"].join("\n"),apogee.codeAnalysis={},apogee.codeAnalysis.syntax={AssignmentExpression:[{name:"left",modified:!0},{name:"right"}],ArrayExpression:[{name:"elements",list:!0}],ArrowFunctionExpression:[{name:"params",list:!0},{name:"body"},{name:"defaults",list:!0}],BlockStatement:[{name:"body",list:!0}],BinaryExpression:[{name:"left"},{name:"right"}],BreakStatement:[],CallExpression:[{name:"callee"},{name:"arguments",list:!0}],CatchClause:[{name:"param",declaration:!0},{name:"body"}],ConditionalExpression:[{name:"test"},{name:"alternate"},{name:"consequent"}],ContinueStatement:[],DoWhileStatement:[{name:"body"},{name:"test",list:!0}],EmptyStatement:[],ExpressionStatement:[{name:"expression"}],ForStatement:[{name:"init"},{name:"test"},{name:"update",list:!0},{name:"body"}],ForOfStatement:[{name:"left"},{name:"right"},{name:"body"}],ForInStatement:[{name:"left"},{name:"right"},{name:"body"}],FunctionDeclaration:[{name:"id",declaration:!0},{name:"params",list:!0,declaration:!0},{name:"body"}],FunctionExpression:[{name:"id",declaration:!0},{name:"params",list:!0,declaration:!0},{name:"body"}],Identifier:[],IfStatement:[{name:"test"},{name:"consequent"},{name:"alternate"}],Literal:[],LabeledStatement:[{name:"body"}],LogicalExpression:[{name:"left"},{name:"right"}],MemberExpression:[],NewExpression:[{name:"callee"},{name:"arguments",list:!0}],Program:[{name:"body",list:!0}],Property:[],ReturnStatement:[{name:"argument"}],SequenceExpression:[{name:"expressions",list:!0}],ObjectExpression:[],SwitchCase:[{name:"test"},{name:"consequent",list:!0}],SwitchStatement:[{name:"discriminant"},{name:"cases",list:!0}],ThisExpression:[],ThrowStatement:[{name:"argument"}],TryStatement:[{name:"block",list:!0},{name:"handler"},{name:"finalizer",list:!0}],UnaryExpression:[{name:"argument"}],UpdateExpression:[{identifierNode:"argument",modified:!0}],VariableDeclaration:[{name:"declarations",list:!0,declaration:!0}],VariableDeclarator:[{name:"id",declaration:!0},{name:"init"}],WhileStatement:[{name:"body"},{name:"test",list:!0}],WithStatement:[{name:"object"},{name:"body"}],YieldExpression:[{name:"argument"}],ArrayPattern:null,AssignmentPattern:null,ClassBody:null,ClassDeclaration:null,ClassExpression:null,DebuggerStatement:null,ExportAllDeclaration:null,ExportDefaultDeclaration:null,ExportNamedDeclaration:null,ExportSpecifier:null,ImportDeclaration:null,ImportDefaultSpecifier:null,ImportNamespaceSpecifier:null,ImportSpecifier:null,MetaProperty:null,MethodDefinition:null,ObjectPattern:null,RestElement:null,SpreadElement:null,Super:null,TaggedTemplateExpression:null,TemplateElement:null,TemplateLiteral:null},apogee.codeAnalysis.KEYWORDS={"abstract":!0,arguments:!0,"boolean":!0,"break":!0,"byte":!0,"case":!0,"catch":!0,"char":!0,"class":!0,"const":!0,"continue":!0,"debugger":!0,"default":!0,"delete":!0,"do":!0,"double":!0,"else":!0,"enum":!0,eval:!0,"export":!0,"extends":!0,"false":!0,"final":!0,"finally":!0,"float":!0,"for":!0,"function":!0,"goto":!0,"if":!0,"implements":!0,"import":!0,"in":!0,"instanceof":!0,"int":!0,"interface":!0,"let":!0,"long":!0,"native":!0,"new":!0,"null":!0,"package":!0,"private":!0,"protected":!0,"public":!0,"return":!0,"short":!0,"static":!0,"super":!0,"switch":!0,"synchronized":!0,"this":!0,"throw":!0,"throws":!0,"transient":!0,"true":!0,"try":!0,"typeof":!0,"var":!0,"void":!0,"volatile":!0,"while":!0,"with":!0,"yield":!0},apogee.codeAnalysis.EXCLUSION_NAMES={undefined:!0,Infinity:!0,NaN:!0,String:!0,Number:!0,Math:!0,Date:!0,Array:!0,Boolean:!0,Error:!0,RegExp:!0,console:!0},apogee.codeAnalysis.analyzeCode=function(a){try{var b={},c=esprima.parse(a,{tolerant:!0,loc:!0});if(c.errors&&c.errors.length>0){b.success=!1,b.errors=[];for(var d=0;d<c.errors.length;d++){var e=c.errors[d],f=new apogee.ActionError(e.description,"Analyze - Code");f.setParentException(e),b.errors.push(f)}}var g=apogee.codeAnalysis.getVariableInfo(c);return b.success=!0,b.varInfo=g,b}catch(h){var f=apogee.ActionError.processException(h,"Analyze - Code",!1);return b.success=!1,b.errors=[],b.errors.push(f),b}},apogee.codeAnalysis.getVariableInfo=function(a){var b={};b.nameTable={},b.scopeTable={};var c=apogee.codeAnalysis.startScope(b);return apogee.codeAnalysis.processTreeNode(b,a,!1,!1),apogee.codeAnalysis.endScope(b,c),apogee.codeAnalysis.markLocalVariables(b),b.nameTable},apogee.codeAnalysis.startScope=function(a){void 0===a.scopeIdGenerator&&(a.scopeIdGenerator=0);var b={};b.id=String(a.scopeIdGenerator++),b.parent=a.currentScope,b.localVariables={},a.scopeTable[b.id]=b,a.currentScope=b},apogee.codeAnalysis.endScope=function(a){var b=a.currentScope;b&&(a.currentScope=b.parent)},apogee.codeAnalysis.processTreeNode=function(a,b,c,d){if("Identifier"==b.type||"MemberExpression"==b.type)apogee.codeAnalysis.processVariable(a,b,c,d);else if("FunctionDeclaration"==b.type||"FunctionExpression"==b.type)apogee.codeAnalysis.processFunction(a,b);else{if("NewExpression"===b.type&&"Function"===b.callee.type)throw apogee.codeAnalysis.createParsingError("Function constructor not currently supported!",b.loc);apogee.codeAnalysis.processGenericNode(a,b)}},apogee.codeAnalysis.processGenericNode=function(a,b){var c=apogee.codeAnalysis.syntax[b.type];if(void 0===c)throw apogee.codeAnalysis.createParsingError("Syntax Tree Node not found: "+b.type,b.loc);if(null===c)throw apogee.codeAnalysis.createParsingError("Syntax node not supported: "+b.type,b.loc);for(var d=0;d<c.length;d++){var e=c[d],f=b[e.name];if(f)if(e.list)for(var g=0;g<f.length;g++)apogee.codeAnalysis.processTreeNode(a,f[g],e.modified,e.declaration);else apogee.codeAnalysis.processTreeNode(a,f,e.modified,e.declaration)}},apogee.codeAnalysis.processFunction=function(a,b){var c=b.type,d=b.id,e=b.params,f=b.body;"FunctionDeclaration"===c&&d&&apogee.codeAnalysis.processTreeNode(a,d,!1,!0);var g=apogee.codeAnalysis.startScope(a);"FunctionExpression"===c&&d&&apogee.codeAnalysis.processTreeNode(a,d,!1,!0);for(var h=0;h<e.length;h++)apogee.codeAnalysis.processTreeNode(a,e[h],!1,!0);apogee.codeAnalysis.processTreeNode(a,f,!1,!1),apogee.codeAnalysis.endScope(a,g)},apogee.codeAnalysis.processVariable=function(a,b,c,d){var e=this.getVariableDotPath(a,b);if(e){var f=e[0];if(!apogee.codeAnalysis.EXCLUSION_NAMES[f]){var g=a.nameTable[f];g||(g={},g.name=f,g.uses=[],a.nameTable[f]=g);var h={};if(h.path=e,h.scope=a.currentScope,h.node=b,h.isModified=c,g.uses.push(h),d){var i=a.currentScope.localVariables;i[f]||(i[f]=!0)}}}},apogee.codeAnalysis.getVariableDotPath=function(a,b){if("Identifier"==b.type)return[b.name];if("MemberExpression"==b.type){if("CallExpression"==b.object.type)return this.processTreeNode(a,b.object,!1,!1),null;var c=this.getVariableDotPath(a,b.object);return b.computed?this.processTreeNode(a,b.property,!1,!1):c.push(b.property.name),c}throw this.createParsingError("Unknown application error: expected a variable identifier node.",b.loc)},apogee.codeAnalysis.markLocalVariables=function(a){for(var b in a.nameTable){for(var c=a.nameTable[b],d=c.name,e=!1,f=0;f<c.uses.length;f++){for(var g=c.uses[f],h=g.scope,i=null,j=h;j;j=j.parent)if(j.localVariables[d]){i=j;break}i?(g.isLocal=!0,g.declarationScope=i):e=!0}e||(c.isLocal=!0)}},apogee.codeAnalysis.createParsingError=function(a,b){var c=apogee.base.createError(a,!1);return b&&(c.lineNumber=b.start.line,c.column=b.start.column),c},apogee.codeDependencies={},apogee.codeDependencies.getDependencyInfo=function(a,b){var c=[],d={};for(var e in a)for(var f=a[e],g=0;g<f.uses.length;g++){var h=f.uses[g];if(!h.isLocal){var i=h.path,j=b.getImpactor(i);if(j){var k=j.getId();d[k]||(c.push(j),d[k]=!0)}}}return c},apogee.calculation={},apogee.calculation.addToRecalculateList=function(a,b){a.indexOf(b)>=0||(b.isDependent&&b.needsCalculating()&&(a.push(b),b.prepareForCalculate()),b.isDataHolder&&apogee.calculation.addDependsOnToRecalculateList(a,b))},apogee.calculation.addDependsOnToRecalculateList=function(a,b){for(var c=b.getImpactsList(),d=0;d<c.length;d++)apogee.calculation.addToRecalculateList(a,c[d])},apogee.calculation.callRecalculateList=function(a,b){var c,d,e=!0;for(d=0;d<a.length;d++)if(c=a[d],c.getCalcPending()&&(c.calculate(),c.hasError())){var f=c.getErrors();if(f)for(var g=0;g<f.length;g++)b.addError(f[g]);e=!1}return e},apogee.action={},apogee.ActionResponse=function(){this.success=!0,this.errors=[],this.fatal=!1},apogee.ActionResponse.prototype.addError=function(a){this.success=!1,a.getIsFatal()&&(this.fatal=!0),this.errors.indexOf(a)<0&&this.errors.push(a)},apogee.ActionResponse.prototype.getSuccess=function(){return this.success},apogee.ActionResponse.prototype.getErrorMsg=function(){var a="";this.fatal&&(a+="Unknown Error: The application is in an indeterminant state. It is recommended it be closed.\n");for(var b=0;b<this.errors.length;b++){var c=this.errors[b],d="";c.member&&(d+=c.member.getName()+": "),d+=c.msg,a+=d+"\n"}return a},apogee.ActionError=function(a,b,c){this.msg=null!=a?a:apogee.ActionError.UNKNOWN_ERROR_MESSAGE,this.errorType=b,this.member=c,this.isFatal=!1,this.parentException=null},apogee.ActionError.UNKNOWN_ERROR_MESSAGE="Unknown Error",apogee.ActionError.prototype.setParentException=function(a){this.parentException=a},apogee.ActionError.prototype.setIsFatal=function(a){this.isFatal=a},apogee.ActionError.prototype.getIsFatal=function(){return this.isFatal},apogee.ActionError.prototype.getType=function(){return this.errorType},apogee.ActionError.processException=function(a,b,c,d){a.stack&&console.error(a.stack);var e=d?d:"";a.message&&(e+=a.message),0==e.length&&(e="Unknown error");var f=new apogee.ActionError(e,b,null);f.setParentException(a);var g;return g=void 0!==a.isFatal?a.isFatal:c,f.setIsFatal(g),f},apogee.Child={},apogee.Child.init=function(a,b){this.id=apogee.Child._createId(),this.name=a,this.generator=b,this.errors=[],this.resultPending=!1},apogee.Child.initOwner=function(a){this.owner=a,a.isParent?this.owner.addChild(this):a.isRootHolder&&this.owner.setRoot(this)},apogee.Child.move=function(a,b){this.owner&&this.owner.isParent&&this.owner.removeChild(this),this.name=a,this.initOwner(b)},apogee.Child.isChild=!0,apogee.Child.getId=function(){return this.id},apogee.Child.getName=function(){return this.name},apogee.Child.getFullName=function(){return this.owner?this.owner.getPossesionNameBase()+this.name:this.name},apogee.Child.getDisplayName=function(a){return a?this.getFullName():this.name},apogee.Child.getOwner=function(){return this.owner},apogee.Child.getParent=function(){return this.owner&&this.owner.isParent?this.owner:null},apogee.Child.getWorkspace=function(){return this.owner?this.owner.getWorkspace():null},apogee.Child.getRoot=function(){for(var a=this;a;){var b=a.getOwner();if(!b)return null;if(!b.isParent)return a;a=b}return null},apogee.Child.addError=function(a){this.errors.push(a)},apogee.Child.addErrors=function(a){this.errors=this.errors.concat(a)},apogee.Child.clearErrors=function(a){var b=[];if(null!=a)for(var c=0;c<this.errors.length;c++){var d=this.errors[c];d.type!=a&&b.push(d)}this.errors=b},apogee.Child.hasError=function(){return this.errors.length>0},apogee.Child.getErrors=function(){return this.errors},apogee.Child.getResultPending=function(){return this.resultPending},apogee.Child.setResultPending=function(a,b){this.resultPending=a,this.pendingToken=b},apogee.Child.pendingTokenMatches=function(a){return this.pendingToken===a},apogee.Child.getSetDataOk=function(){return this.generator.setDataOk},apogee.Child.getSetCodeOk=function(){return this.generator.setCodeOk},apogee.Child.toJson=function(){var a={};if(a.name=this.name,a.type=this.generator.type,this.addToJson&&this.addToJson(a),this.getUpdateData){var b=this.getUpdateData();a.updateData=b}return a},apogee.Child.onDeleteChild=function(){this.owner&&(this.owner.isParent?this.owner.removeChild(this):this.owner.isRootHolder&&this.owner.setRoot(null),this.owner=null)},apogee.Child.nextId=1,apogee.Child._createId=function(){return apogee.Child.nextId++},apogee.ContextHolder={},apogee.ContextHolder.init=function(){this.contextManager=null},apogee.ContextHolder.isContextHolder=!0,apogee.ContextHolder.getContextManager=function(){return this.contextManager||(this.contextManager=this.createContextManager()),this.contextManager},apogee.ContextManager.prototype.getImpactor=function(a){return this.hierarchicalLookup("lookupImpactor",a)},apogee.DataHolder={},apogee.DataHolder.init=function(){this.data=null,this.impactsList=[]},apogee.DataHolder.isDataHolder=!0,apogee.Child.getData=function(){return this.data},apogee.DataHolder.getImpactsList=function(){return this.impactsList},apogee.DataHolder.setData=function(a){this.data=a;var b=this.getParent();b&&b.updateData(this)},apogee.DataHolder.addToImpactsList=function(a){if(a!==this)return this.impactsList.indexOf(a)===-1&&(this.impactsList.push(a),!0)},apogee.DataHolder.removeFromImpactsList=function(a){for(var b=0;b<this.impactsList.length;b++)if(this.impactsList[b]==a)return void this.impactsList.splice(b,1)},apogee.Dependent={},apogee.Dependent.init=function(){this.dependsOnList=[],this.calcPending=!1},apogee.Dependent.isDependent=!0,apogee.Dependent.getDependsOn=function(){return this.dependsOnList},apogee.Dependent.getCalcPending=function(){return this.calcPending},apogee.Dependent.clearCalcPending=function(){this.calcPending=!1},apogee.Dependent.prepareForCalculate=function(){this.clearErrors(),this.setResultPending(!1),this.calcPending=!0},apogee.Dependent.initializeImpactors=function(){for(var a=[],b=!1,c=0;c<this.dependsOnList.length;c++){var d=this.dependsOnList[c];d.getCalcPending()&&d.calculate(),d.hasError()?a.push(d):d.getResultPending()&&(b=!0)}a.length>0?this.createDependencyError(a):b&&this.setResultPending(!0,apogee.action.DEPENDENT_PENDING_TOKEN)},apogee.Dependent.onDeleteDependent=function(){for(var a=0;a<this.dependsOnList.length;a++){var b=this.dependsOnList[a];b.removeFromImpactsList(this)}},apogee.Dependent.updateDependencies=function(a){var b=!1;a||(a=[]);var c=this.dependsOnList;this.dependsOnList=[];var d,e,f={};for(e=0;e<a.length;e++)if(d=a[e],d.isDataHolder){this.dependsOnList.push(d);var g=d.addToImpactsList(this);g&&(b=!0),f[d.getId()]=!0}else;for(e=0;e<c.length;e++){d=c[e];var h=f[d.getId()];h||(d.removeFromImpactsList(this),b=!0)}return b},apogee.Dependent.createDependencyError=function(a){for(var b="Error in dependency: ",c=0;c<a.length;c++)c>0&&(b+=", "),b+=a[c].getFullName();var d=new apogee.ActionError(b,"Calculation - Dependency",this);this.addError(d)},apogee.Codeable={},apogee.Codeable.init=function(a){this.argList=a,this.codeSet=!1,this.functionBody="",this.supplementalCode="",this.description="",this.varInfo=null,this.dependencyInfo=null,this.memberFunctionInitializer=null,this.memberFunction=null,this.codeErrors=[],this.clearCalcPending(),this.setResultPending(!1),this.calcInProgress=!1,this.functionInitialized=!1,this.initReturnValue=!1},apogee.Codeable.isCodeable=!0,apogee.Codeable.MEMBER_FUNCTION_PENDING="pending",apogee.Codeable.getArgList=function(){return this.argList},apogee.Codeable.getFunctionBody=function(){return this.functionBody},apogee.Codeable.getSupplementalCode=function(){return this.supplementalCode},apogee.Codeable.getDescription=function(){return this.description},apogee.Codeable.setDescription=function(a){this.description=a},apogee.Codeable.setCodeInfo=function(a){if(this.argList=a.argList,this.functionBody=a.functionBody,this.supplementalCode=a.supplementalCode,this.varInfo=a.varInfo,a.errors&&0!==a.errors.length)this.codeErrors=a.errors;else try{var b=this,c=function(){return b.memberFunctionInitialize()},d=new apogee.action.Messenger(this),e=a.generatorFunction(c,d);this.memberFunction=e.memberFunction,this.memberFunctionInitializer=e.initializer,this.codeErrors=[]}catch(f){this.codeErrors.push(apogee.ActionError.processException(f,"Codeable - Set Code",!1))}this.codeErrors.length>0&&(this.memberFunction=null,this.memberFunctionInitializer=null),this.codeSet=!0},apogee.Codeable.initializeDependencies=function(){if(this.hasCode()&&this.varInfo&&0===this.codeErrors.length)try{var a=apogee.codeDependencies.getDependencyInfo(this.varInfo,this.getContextManager());this.updateDependencies(a)}catch(b){this.codeErrors.push(apogee.ActionError.processException(b,"Codeable - Set Dependencies",!1))}else this.updateDependencies([])},apogee.Codeable.updateDependeciesForModelChange=function(a){if(this.hasCode()&&this.varInfo){var b=apogee.codeDependencies.getDependencyInfo(this.varInfo,this.getContextManager()),c=this.updateDependencies(b);c&&apogee.calculation.addToRecalculateList(a,this)}},apogee.Codeable.clearCode=function(){this.codeSet=!1,this.functionBody="",this.supplementalCode="",this.varInfo=null,this.dependencyInfo=null,this.memberFunctionInitializer=null,this.memberFunction=null,this.codeErrors=[],this.clearCalcPending(),this.setResultPending(!1);var a=[];this.updateDependencies(a)},apogee.Codeable.hasCode=function(){return this.codeSet},apogee.Codeable.needsCalculating=function(){return this.codeSet},apogee.Codeable.prepareForCalculate=function(){apogee.Dependent.prepareForCalculate.call(this),this.functionInitialized=!1,this.initReturnValue=!1},apogee.Codeable.calculate=function(){if(this.codeErrors.length>0)return this.addErrors(this.codeErrors),void this.clearCalcPending();if(!this.memberFunction||!this.memberFunctionInitializer){var a="Function not found for member: "+this.getName(),b=new apogee.ActionError(a,"Codeable - Calculate",this);return this.addError(b),void this.clearCalcPending()}try{this.processMemberFunction(this.memberFunction)}catch(c){if(c==apogee.Codeable.MEMBER_FUNCTION_PENDING)this.setResultPending(!0);else{c.stack&&console.error(c.stack);var d=c.message?c.message:"Unknown error",b=new apogee.ActionError(d,"Codeable - Calculate",this);b.setParentException(c),this.addError(b)}}this.clearCalcPending()},apogee.Codeable.memberFunctionInitialize=function(){if(this.functionInitialized)return this.initReturnValue;if(this.calcInProgress){var a="Circular reference error",b=new apogee.ActionError(a,"Codeable - Calculate",this);return this.addError(b),this.calcInProgress=!1,this.functionInitialized=!0,this.initReturnValue=!1,this.initReturnValue}this.calcInProgress=!0;try{if(this.initializeImpactors(),this.hasError()||this.getResultPending())return this.calcInProgress=!1,this.functionInitialized=!0,this.initReturnValue=!1,this.initReturnValue;this.memberFunctionInitializer(this.getContextManager()),this.initReturnValue=!0}catch(c){c.stack&&console.error(c.stack);var a=c.message?c.message:"Unknown error",b=new apogee.ActionError(a,"Codeable - Calculate",this);b.setParentException(c),this.addError(b),this.initReturnValue=!1}finally{this.postInitializeAction&&this.postInitializeAction()}return this.calcInProgress=!1,this.functionInitialized=!0,this.initReturnValue},apogee.Codeable.getUpdateData=function(){var a={};return this.hasCode()?(a.argList=this.getArgList(),a.functionBody=this.getFunctionBody(),a.supplementalCode=this.getSupplementalCode()):a.data=this.getData(),a.description=this.getDescription(),a},apogee.Codeable.createContextManager=function(){return new apogee.ContextManager(this)},apogee.Owner={},apogee.Owner.init=function(){},apogee.Owner.isOwner=!0,apogee.Owner.getMemberByFullName=function(a){var b=a.split(".");return this.getMemberByPathArray(b)},apogee.Parent={},apogee.Parent.ROOT_NAME="root",apogee.Parent.init=function(){},apogee.Parent.isParent=!0,apogee.Parent.isRoot=function(){return null==this.getParent()},apogee.Parent.lookupChildFromPathArray=function(a,b){void 0===b&&(b=0);var c=this.lookupChild(a[b]);if(c)return b<a.length-1?c.isParent?c.lookupChildFromPathArray(a,b+1):c.isOwner?c.getMemberByPathArray(a,b+1):c:c},apogee.Parent.createContextManager=function(){var a=new apogee.ContextManager(this),b={};return b.parent=this,a.addToContextList(b),a},apogee.Parent.getPossesionNameBase=function(){return this.getFullName()+"."},apogee.RootHolder={},apogee.RootHolder.init=function(){},apogee.RootHolder.isRootHolder=!0,apogee.Workspace=function(a,b,c){apogee.EventManager.init.call(this),apogee.ContextHolder.init.call(this),apogee.Owner.init.call(this),apogee.RootHolder.init.call(this),this.actionInProgress=!1,this.actionQueue=[],void 0===c&&(c=null),this.owner=c,a?this.loadFromJson(a,b):this.rootFolder=new apogee.Folder(apogee.Workspace.ROOT_FOLDER_NAME,this)},apogee.base.mixin(apogee.Workspace,apogee.EventManager),apogee.base.mixin(apogee.Workspace,apogee.ContextHolder),apogee.base.mixin(apogee.Workspace,apogee.Owner),apogee.base.mixin(apogee.Workspace,apogee.RootHolder),apogee.Workspace.ROOT_FOLDER_NAME="Workspace",apogee.Workspace.prototype.getRoot=function(){return this.rootFolder},apogee.Workspace.prototype.setRoot=function(a){this.rootFolder=a},apogee.Workspace.prototype.getOwner=function(){return this.owner},apogee.Workspace.prototype.updateDependeciesForModelChange=function(a){this.rootFolder&&this.rootFolder.updateDependeciesForModelChange(a)},apogee.Workspace.prototype.onClose=function(){this.rootFolder.onClose()},apogee.Workspace.prototype.isActionInProgress=function(){return this.actionInProgress},apogee.Workspace.prototype.setActionInProgress=function(a){this.actionInProgress=a},apogee.Workspace.prototype.queueAction=function(a){this.actionQueue.push(a)},apogee.Workspace.prototype.getQueuedAction=function(){if(this.actionQueue.length>0){var a=this.actionQueue[0];return this.actionQueue.splice(0,1),a}return null},apogee.Workspace.prototype.getWorkspace=function(){return this},apogee.Workspace.prototype.getPossesionNameBase=function(){return""},apogee.Workspace.prototype.getMemberByPathArray=function(a,b){return void 0===b&&(b=0),0===a.length?this.rootFolder:this.rootFolder.lookupChildFromPathArray(a,b)},apogee.Workspace.prototype.createContextManager=function(){var a=new apogee.ContextManager(this);if(this.owner)apogee.Workspace.flattenParentIntoContextManager(a,this.owner);else{var b={};b.data=__globals__,a.addToContextList(b)}return a},apogee.Workspace.createVirtualWorkpaceFromFolder=function(a,b,c){var d={};d.fileType=apogee.Workspace.SAVE_FILE_TYPE,d.version=apogee.Workspace.SAVE_FILE_VERSION,d.data=b.toJson();var e=new apogee.Workspace(d,null,c);return e},apogee.Workspace.flattenParentIntoContextManager=function(a,b){for(var c=b;null!=c;c=c.getOwner())for(var d=c.getContextManager(),e=d.contextList,f=0;f<e.length;f++){var g=e[f];g.parent?a.addToContextList(apogee.Workspace.convertToDataContextEntry(g)):g.data&&a.addToContextList(g)}},apogee.Workspace.convertToDataContextEntry=function(a){var b={};return a.parent.isDataHolder&&(b.data=a.parent.getData()),b},apogee.Workspace.SAVE_FILE_TYPE="apogee workspace",apogee.Workspace.SAVE_FILE_VERSION=.2,apogee.Workspace.prototype.toJson=function(a){var b={};b.fileType=apogee.Workspace.SAVE_FILE_TYPE,b.version=apogee.Workspace.SAVE_FILE_VERSION;var c;return c=a?a:this.rootFolder,b.data=c.toJson(),b},apogee.Workspace.prototype.loadFromJson=function(a,b){var c=a.fileType;if(c!==apogee.Workspace.SAVE_FILE_TYPE)throw apogee.base.createError("Bad file format.",!1);if(a.version!==apogee.Workspace.SAVE_FILE_VERSION)throw apogee.base.createError("Incorrect file version. CHECK APOGEEJS.COM FOR VERSION CONVERTER.",!1);b||(b=new apogee.ActionResponse);var d=a.data;return d.action="createMember",d.owner=this,d.workspace=this,apogee.action.doAction(d,b),b},apogee.Workspace.memberGenerators={},apogee.Workspace.getMemberGenerator=function(a){return apogee.Workspace.memberGenerators[a]},apogee.Workspace.addMemberGenerator=function(a){apogee.Workspace.memberGenerators[a.type]=a},apogee.JsonTable=function(a,b,c){apogee.Child.init.call(this,a,apogee.JsonTable.generator),apogee.DataHolder.init.call(this),apogee.Dependent.init.call(this),apogee.ContextHolder.init.call(this),apogee.Codeable.init.call(this,[],!0),this.initOwner(b),c||(c={},c.data=""),void 0!==c.functionBody?apogee.updatemember.applyCode(this,c.argList,c.functionBody,c.supplementalCode):(void 0===c.data&&(c.data=""),apogee.updatemember.applyData(this,c.data)),void 0!==c.description&&this.setDescription(c.description)},apogee.base.mixin(apogee.JsonTable,apogee.Child),apogee.base.mixin(apogee.JsonTable,apogee.DataHolder),apogee.base.mixin(apogee.JsonTable,apogee.Dependent),apogee.base.mixin(apogee.JsonTable,apogee.ContextHolder),apogee.base.mixin(apogee.JsonTable,apogee.Codeable),apogee.JsonTable.prototype.setData=function(a){return apogee.base.deepFreeze(a),apogee.DataHolder.setData.call(this,a)},apogee.JsonTable.prototype.getArgList=function(){return[]},apogee.JsonTable.prototype.processMemberFunction=function(a){
var b=a();if(apogee.base.isPromise(b)){var c=apogee.action.getAsynchToken();this.setResultPending(!0,c);var d=this,e=function(a){var b={};b.action="asynchFormulaData",b.member=d,b.token=c,b.data=a;apogee.action.doAction(b)},f=function(a){var b={};b.action="updateError",b.member=d,b.token=c,b.errorMsg=a;apogee.action.doAction(b)};b.then(e)["catch"](f)}else this.setData(b)},apogee.JsonTable.fromJson=function(a,b){return new apogee.JsonTable(b.name,a,b.updateData)},apogee.JsonTable.generator={},apogee.JsonTable.generator.displayName="Table",apogee.JsonTable.generator.type="apogee.JsonTable",apogee.JsonTable.generator.createMember=apogee.JsonTable.fromJson,apogee.JsonTable.generator.setDataOk=!0,apogee.JsonTable.generator.setCodeOk=!0,apogee.Workspace.addMemberGenerator(apogee.JsonTable.generator),apogee.FunctionTable=function(a,b,c){apogee.Child.init.call(this,a,apogee.FunctionTable.generator),apogee.DataHolder.init.call(this),apogee.Dependent.init.call(this),apogee.ContextHolder.init.call(this),apogee.Codeable.init.call(this,d,!1),this.initOwner(b);var d=c.argList?c.argList:[],e=c.functionBody?c.functionBody:"",f=c.supplementalCode?c.supplementalCode:"";apogee.updatemember.applyCode(this,d,e,f),void 0!==c.description&&this.setDescription(c.description)},apogee.base.mixin(apogee.FunctionTable,apogee.Child),apogee.base.mixin(apogee.FunctionTable,apogee.DataHolder),apogee.base.mixin(apogee.FunctionTable,apogee.Dependent),apogee.base.mixin(apogee.FunctionTable,apogee.ContextHolder),apogee.base.mixin(apogee.FunctionTable,apogee.Codeable),apogee.FunctionTable.prototype.processMemberFunction=function(a){this.setData(a)},apogee.FunctionTable.prototype.postInitializeAction=function(){if(this.getResultPending())throw apogee.Codeable.MEMBER_FUNCTION_PENDING},apogee.FunctionTable.prototype.getDisplayName=function(a){var b=a?this.getFullName():this.getName(),c=this.getArgList(),d=c.join(",");return b+"("+d+")"},apogee.FunctionTable.fromJson=function(a,b){return new apogee.FunctionTable(b.name,a,b.updateData)},apogee.FunctionTable.addPropValues=function(a,b){var c=a.getArgList(),d=c.toString();return b.argListString=d,b},apogee.FunctionTable.getPropertyUpdateAction=function(a,b,c){if(b.argListString!==c.argListString){var d=apogee.FunctionTable.parseStringArray(c.argListString),e={};return e.action="updateCode",e.member=a,e.argList=d,e.functionBody=a.getFunctionBody(),e.supplementalCode=a.getSupplementalCode(),e}return null},apogee.FunctionTable.parseStringArray=function(a){for(var b=a.split(","),c=0;c<b.length;c++)b[c]=b[c].trim();return b},apogee.FunctionTable.generator={},apogee.FunctionTable.generator.displayName="Function",apogee.FunctionTable.generator.type="apogee.FunctionTable",apogee.FunctionTable.generator.createMember=apogee.FunctionTable.fromJson,apogee.FunctionTable.generator.addPropFunction=apogee.FunctionTable.addPropValues,apogee.FunctionTable.generator.getPropertyUpdateAction=apogee.FunctionTable.getPropertyUpdateAction,apogee.FunctionTable.generator.setDataOk=!1,apogee.FunctionTable.generator.setCodeOk=!0,apogee.Workspace.addMemberGenerator(apogee.FunctionTable.generator),apogee.Folder=function(a,b){apogee.Child.init.call(this,a,apogee.Folder.generator),apogee.DataHolder.init.call(this),apogee.Dependent.init.call(this),apogee.ContextHolder.init.call(this),apogee.Owner.init.call(this),apogee.Parent.init.call(this),this.initOwner(b),this.childMap={},this.dataMap={},Object.freeze(this.dataMap),this.setData(this.dataMap)},apogee.base.mixin(apogee.Folder,apogee.Child),apogee.base.mixin(apogee.Folder,apogee.DataHolder),apogee.base.mixin(apogee.Folder,apogee.Dependent),apogee.base.mixin(apogee.Folder,apogee.ContextHolder),apogee.base.mixin(apogee.Folder,apogee.Owner),apogee.base.mixin(apogee.Folder,apogee.Parent),apogee.Folder.prototype.getChildMap=function(){return this.childMap},apogee.Folder.prototype.lookupChild=function(a){return this.childMap[a]},apogee.Folder.prototype.addChild=function(a){var b=a.getName();if(this.childMap[b])throw apogee.base.createError("There is already an object with the given name.",!1);if(this.childMap[b]=a,a.isDataHolder){var c=a.getData();void 0!==c&&this.spliceDataMap(b,c)}this.calculateDependents()},apogee.Folder.prototype.removeChild=function(a){var b=a.getParent();if(b&&b===this){var c=a.getName();delete this.childMap[c],a.isDataHolder&&this.spliceDataMap(c),this.calculateDependents()}},apogee.Folder.prototype.updateData=function(a){if(a.isDataHolder){var b=a.getName(),c=a.getData();return void 0===this.childMap[b]?void alert("Error - this table "+b+" has not yet been added to the folder."):void this.spliceDataMap(b,c)}},apogee.Folder.prototype.needsCalculating=function(){return!0},apogee.Folder.prototype.calculate=function(){this.initializeImpactors(),this.clearCalcPending()},apogee.Folder.prototype.updateDependeciesForModelChange=function(a){for(var b in this.childMap){var c=this.childMap[b];c.isDependent&&c.updateDependeciesForModelChange(a)}},apogee.Folder.fromJson=function(a,b,c){var d=new apogee.Folder(b.name,a);for(var e in b.children){var f=b.children[e];c.push(f)}return d},apogee.Folder.prototype.addToJson=function(a){a.children={};for(var b in this.childMap){var c=this.childMap[b];a.children[b]=c.toJson()}},apogee.Folder.prototype.onClose=function(){for(var a in this.childMap){var b=this.childMap[a];b.onClose&&b.onClose()}},apogee.Folder.prototype.calculateDependents=function(){var a=[];for(var b in this.childMap){var c=this.childMap[b];c.isDataHolder&&a.push(c)}this.updateDependencies(a)},apogee.Folder.prototype.spliceDataMap=function(a,b){var c={};for(var d in this.dataMap)d!==a&&(c[d]=this.dataMap[d]);void 0!==b&&(c[a]=b),Object.freeze(c),this.dataMap=c,this.setData(this.dataMap)},apogee.Folder.generator={},apogee.Folder.generator.displayName="Folder",apogee.Folder.generator.type="apogee.Folder",apogee.Folder.generator.createMember=apogee.Folder.fromJson,apogee.Folder.generator.setDataOk=!1,apogee.Folder.generator.setCodeOk=!1,apogee.Workspace.addMemberGenerator(apogee.Folder.generator),apogee.FolderFunction=function(a,b,c,d){if(apogee.Child.init.call(this,a,apogee.FolderFunction.generator),apogee.DataHolder.init.call(this),apogee.Dependent.init.call(this),apogee.ContextHolder.init.call(this),apogee.Owner.init.call(this),apogee.RootHolder.init.call(this),this.initOwner(b),this.argList=void 0!==c.argList?c.argList:"",this.returnValueString=void 0!==c.returnValue?c.returnValue:[],this.setData(function(){}),d){var e=new apogee.Folder(apogee.FolderFunction.INTERNAL_FOLDER_NAME,this);this.setRoot(e)}},apogee.base.mixin(apogee.FolderFunction,apogee.Child),apogee.base.mixin(apogee.FolderFunction,apogee.DataHolder),apogee.base.mixin(apogee.FolderFunction,apogee.Dependent),apogee.base.mixin(apogee.FolderFunction,apogee.ContextHolder),apogee.base.mixin(apogee.FolderFunction,apogee.Owner),apogee.base.mixin(apogee.FolderFunction,apogee.RootHolder),apogee.FolderFunction.INTERNAL_FOLDER_NAME="root",apogee.FolderFunction.prototype.getInternalFolder=function(){return this.internalFolder},apogee.FolderFunction.prototype.getRoot=function(){return this.getInternalFolder()},apogee.FolderFunction.prototype.setRoot=function(a){this.internalFolder=a;var b=[];a&&b.push(a),this.updateDependencies(b)},apogee.FolderFunction.prototype.getReturnValueString=function(){return this.returnValueString},apogee.FolderFunction.prototype.getArgList=function(){return this.argList},apogee.FolderFunction.prototype.getDisplayName=function(a){var b=a?this.getFullName():this.getName(),c=this.getArgList(),d=c.join(","),e=b+"("+d+")";return null!=this.returnValueString&&this.returnValueString.length>0&&(e+=" = "+this.returnValueString),e},apogee.FolderFunction.prototype.close=function(){this.internalFolder.onClose()},apogee.FolderFunction.prototype.onDelete=function(){var a;if(this.internalFolder){var b={};b.action="deleteMember",b.member=this.internalFolder;var c=apogee.action.doAction(b);if(!c.getSuccess()){var d=c.getErrorMsg();alert(d)}}return a=apogee.Child.onDelete.call(this)},apogee.FolderFunction.fromJson=function(a,b,c){var d={};d.argList=b.argList,d.returnValue=b.returnValue;var e;return b.internalFolder?(c.push(b.internalFolder),e=!1):e=!0,new apogee.FolderFunction(b.name,a,d,e)},apogee.FolderFunction.prototype.addToJson=function(a){a.argList=this.argList,a.returnValue=this.returnValueString,a.internalFolder=this.internalFolder.toJson()},apogee.FolderFunction.addPropValues=function(a,b){var c=a.getArgList(),d=c.toString();return b.argListString=d,b.returnValueString=a.getReturnValueString(),b},apogee.FolderFunction.getPropertyUpdateAction=function(a,b,c){if(b.argListString!==c.argListString||b.returnValueString!==c.returnValueString){var d=apogee.FunctionTable.parseStringArray(c.argListString);a.setArgList(d),a.setReturnValueString(c.returnValueString);var e={};return e.action="updateFolderFunction",e.member=a,e.argList=d,e.returnValueString=c.returnValueString,e}return null},apogee.FolderFunction.prototype.needsCalculating=function(){return!0},apogee.FolderFunction.prototype.calculate=function(){this.initializeImpactors();var a=[],b=this.getFolderFunctionFunction(a);0==a.length?this.setData(b):this.addErrors(a),this.clearCalcPending()},apogee.FolderFunction.prototype.updateDependeciesForModelChange=function(a){this.internalFolder&&this.internalFolder.updateDependeciesForModelChange(a)},apogee.FolderFunction.prototype.createContextManager=function(){return new apogee.ContextManager(this)},apogee.FolderFunction.prototype.getChildMap=function(){return this.internalFolder.childMap},apogee.FolderFunction.prototype.lookupChild=function(a){return this.internalFolder.childMap[a]},apogee.FolderFunction.prototype.getPossesionNameBase=function(){return this.getFullName()+"."},apogee.FolderFunction.prototype.getMemberByPathArray=function(a,b){return void 0===b&&(b=0),a[b]===apogee.FolderFunction.INTERNAL_FOLDER_NAME?this.internalFolder:this.internalFolder.lookupChildFromPathArray(a,b)},apogee.FolderFunction.prototype.setReturnValueString=function(a){this.returnValueString=a},apogee.FolderFunction.prototype.setArgList=function(a){this.argList=a},apogee.FolderFunction.prototype.getFolderFunctionFunction=function(a){var b,c,d,e,f=!1,g=this,h=function(h){if(!f){if(b=g.createVirtualWorkspace(a),!b)return null;c=b.getRoot(),d=g.loadInputElements(c,a),e=g.loadOutputElement(c,a),f=!0}for(var i=[],j=0;j<d.length;j++){var k={};k.action="updateData",k.member=d[j],k.data=arguments[j],i.push(k)}var l={};l.action="compoundAction",l.actions=i,l.workspace=b;var m=apogee.action.doAction(l);if(!m.getSuccess())throw apogee.base.createError(m.getErrorMsg());if(e){if(e.getResultPending())throw new Error("A folder function must not be asynchronous: "+g.getFullName());return e.getData()}};return h},apogee.FolderFunction.prototype.createVirtualWorkspace=function(a){try{return apogee.Workspace.createVirtualWorkpaceFromFolder(this.getName(),this.internalFolder,this.getOwner())}catch(b){var c=apogee.ActionError.processException(exception,"FolderFunction - Code",!1);return a.push(c),null}},apogee.FolderFunction.prototype.loadInputElements=function(a,b){for(var c=[],d=0;d<this.argList.length;d++){var e=this.argList[d],f=a.lookupChild(e);f&&c.push(f)}return c},apogee.FolderFunction.prototype.loadOutputElement=function(a,b){var c=a.lookupChild(this.returnValueString);return c},apogee.FolderFunction.generator={},apogee.FolderFunction.generator.displayName="Folder Function",apogee.FolderFunction.generator.type="apogee.FolderFunction",apogee.FolderFunction.generator.createMember=apogee.FolderFunction.fromJson,apogee.FolderFunction.generator.addPropFunction=apogee.FolderFunction.addPropValues,apogee.FolderFunction.generator.getPropertyUpdateAction=apogee.FolderFunction.getPropertyUpdateAction,apogee.FolderFunction.generator.setDataOk=!1,apogee.FolderFunction.generator.setCodeOk=!1,apogee.Workspace.addMemberGenerator(apogee.FolderFunction.generator),apogee.action={},apogee.action.actionInfo={},apogee.action.doAction=function(a,b,c){var d;if(a.member)d=a.member.getWorkspace();else{if(!a.workspace)throw new Error("Workspace info missing from action. ");d=a.workspace}if(d.isActionInProgress()){var e={};return e.actionData=a,e.optionalContext=b,e.optionalActionResponse=c,d.queueAction(e),new apogee.ActionResponse}d.setActionInProgress(!0);var f=c?c:new apogee.ActionResponse;try{var g=[];apogee.action.callActionFunction(a,b,g);var h=[];apogee.action.updateDependencies(d,g,h),apogee.action.updateRecalculateList(g,h),apogee.calculation.callRecalculateList(h,f),apogee.action.fireEvents(d,g,h)}catch(i){var j=apogee.ActionError.processException(i,"AppException",!0);f.addError(j)}d.setActionInProgress(!1);var k=d.getQueuedAction();return k&&apogee.action.asynchRunQueuedAction(k),f},apogee.action.addActionInfo=function(a,b){apogee.action.actionInfo[a]=b},apogee.action.callActionFunction=function(a,b,c){var d=apogee.action.actionInfo[a.action];d?(a.actionInfo=d,d.actionFunction(a,b,c)):a.error=new apogee.ActionError("Unknown action: "+a.action,"AppException",null)},apogee.action.getAsynchToken=function(){return Math.random()},apogee.action.DEPENDENT_PENDING_TOKEN=-1,apogee.action.dataUpdate=function(a,b,c){var d=b.getWorkspace(),e=b.getContextManager(),f={};return f.action="updateData",f.memberName=a,f.workspace=d,f.data=c,apogee.action.doAction(f,e)},apogee.action.compoundDataUpdate=function(a,b){var c=b.getWorkspace(),d=b.getContextManager(),e={};return e.action=apogee.compoundaction.ACTION_NAME,e.actions=apogee.action.updateInfoToActionList(a,c),e.workspace=c,apogee.action.doAction(e,d)},apogee.action.errorUpdate=function(a,b,c){var d=b.getWorkspace(),e=b.getContextManager(),f={};return f.action="updateError",f.memberName=a,f.workspace=d,f.errorMsg=c,apogee.action.doAction(f,e)},apogee.action.asynchDataUpdate=function(a,b,c){var d=b.getWorkspace(),e=b.getContextManager(),f=apogee.action.getAsynchToken(),g={};g.action="updateDataPending",g.memberName=a,g.workspace=d,g.token=f;var h=(apogee.action.doAction(g,e),function(b){var c={};c.action="updateData",c.memberName=a,c.workspace=d,c.token=f,c.data=b;apogee.action.doAction(c,e)}),i=function(b){var c={};c.action="updateError",c.memberName=a,c.workspace=d,c.token=f,c.errorMsg=b;apogee.action.doAction(c,e)};c.then(h)["catch"](i)},apogee.action.updateInfoToActionList=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d],f={};f.action="updateData",f.memberName=e[0],f.workspace=b,f.data=e[1],c.push(f)}return c},apogee.action.asynchRunQueuedAction=function(a){var b=function(){apogee.action.doAction(a.actionData,a.optionalContext,a.optionalActionResponse)};setTimeout(b,0)},apogee.action.updateDependencies=function(a,b,c){var d=apogee.action.checkUpdateAllDep(b);if(d)a.updateDependeciesForModelChange(c);else for(var e=0;e<b.length;e++){var f=b[e];apogee.action.doInitializeDependencies(f)&&f.member.initializeDependencies()}},apogee.action.updateRecalculateList=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];apogee.action.doAddToRecalc(d)?apogee.calculation.addToRecalculateList(b,d.member):apogee.action.doAddDependOnToRecalc(d)&&apogee.calculation.addDependsOnToRecalculateList(b,d.member)}},apogee.action.fireEvents=function(a,b,c){for(var d,e={},f=0;f<b.length;f++){var g=b[f];if(g.actionInfo){var h=g.actionInfo.event;if(!h)continue;var d=g.member;apogee.action.fireEvent(a,h,d),d&&(e[g.member.getId()]=!0)}}for(f=0;f<c.length;f++){var d=c[f];e[d.getId()]||apogee.action.fireEvent(a,apogee.updatemember.MEMBER_UPDATED_EVENT,d)}},apogee.action.fireEvent=function(a,b,c){a.dispatchEvent(b,c)},apogee.action.checkUpdateAllDep=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.member;if(d&&d.isDataHolder&&c.actionInfo&&c.actionInfo.checkUpdateAll)return!0}return!1},apogee.action.doInitializeDependencies=function(a){return!!a.actionInfo&&a.actionInfo.updateDependencies},apogee.action.doAddToRecalc=function(a){return!!a.actionInfo&&a.actionInfo.addToRecalc},apogee.action.doAddDependOnToRecalc=function(a){return!!a.actionInfo&&a.actionInfo.addDependenceiesToRecalc},apogee.compoundaction={},apogee.compoundaction.ACTION_NAME="compoundAction",apogee.compoundaction.compoundActionFunction=function(a,b,c){for(var d=a.actions,e=0;e<d.length;e++){var f=d[e];apogee.action.callActionFunction(f,b,c)}},apogee.compoundaction.ACTION_INFO={actionFunction:apogee.compoundaction.compoundActionFunction,checkUpdateAll:!1,updateDependencies:!1,addToRecalc:!1,event:null},apogee.action.addActionInfo(apogee.compoundaction.ACTION_NAME,apogee.compoundaction.ACTION_INFO),apogee.createmember={},apogee.createmember.ACTION_NAME="createMember",apogee.createmember.MEMBER_CREATED_EVENT="memberCreated",apogee.createmember.createMember=function(a,b,c){var d=apogee.Workspace.getMemberGenerator(a.type);if(!d)return a.error=new apogee.ActionError("Member type not found: "+a.type,"AppException",null),null;var e=[],f=d.createMember(a.owner,a,e);a.member=f,c.push(a);for(var g=0;g<e.length;g++){var h=e[g];h.action="createMember",h.actionInfo=a.actionInfo,h.owner=f,apogee.createmember.createMember(h,b,c)}return f},apogee.createmember.ACTION_INFO={actionFunction:apogee.createmember.createMember,checkUpdateAll:!0,updateDependencies:!0,addToRecalc:!0,event:apogee.createmember.MEMBER_CREATED_EVENT},apogee.action.addActionInfo(apogee.createmember.ACTION_NAME,apogee.createmember.ACTION_INFO),apogee.updatemember={},apogee.updatemember.UPDATE_DATA_ACTION_NAME="updateData",apogee.updatemember.UPDATE_CODE_ACTION_NAME="updateCode",apogee.updatemember.UPDATE_DATA_PENDING_ACTION_NAME="updateDataPending",apogee.updatemember.UPDATE_ASYNCH_DATA_ACTION_NAME="asynchFormulaData",apogee.updatemember.UPDATE_ASYNCH_ERROR_ACTION_NAME="updateError",apogee.updatemember.UPDATE_DESCRIPTION_ACTION_NAME="updateDescription",apogee.updatemember.MEMBER_UPDATED_EVENT="memberUpdated",apogee.updatemember.updateCode=function(a,b,c){if(!a.member.getSetCodeOk())throw new Error("can not set code on member: "+member.getFullName());apogee.updatemember.applyCode(a.member,a.argList,a.functionBody,a.supplementalCode),c.push(a)},apogee.updatemember.updateData=function(a,b,c){if(a.member||apogee.updatemember.loadMemberName(a,b),!a.member.getSetDataOk())throw new Error("can not set data on member: "+d.getFullName());var d=a.member;apogee.updatemember.applyData(d,a.data),d.isCodeable&&d.clearCode(),c.push(a)},apogee.updatemember.updateDataPending=function(a,b,c){a.member||apogee.updatemember.loadMemberName(a,b);var d=a.member,e=a.token;d.setResultPending(!0,e),c.push(a)},apogee.updatemember.asynchFunctionUpdateData=function(a,b,c){if(!a.member.getSetCodeOk())throw new Error("can not set code on member: "+d.getFullName());var d=a.member,e=a.token;d.pendingTokenMatches(e)&&(apogee.updatemember.applyData(d,a.data),d.setResultPending(!1),c.push(a))},apogee.updatemember.asynchFunctionUpdateError=function(a,b,c){a.member||apogee.updatemember.loadMemberName(a,b);var d=a.member,e=a.token;if(d.pendingTokenMatches(e)){var f=new apogee.ActionError(a.errorMsg,"Codeable - Calculate",d);d.addError(f),d.setResultPending(!1),c.push(a)}},apogee.updatemember.updateDescription=function(a,b,c){var d=a.member;d.setDescription(a.description),c.push(a)},apogee.updatemember.applyCode=function(a,b,c,d){var e={};e.argList=b,e.functionBody=c,e.supplementalCode=d;var f=a.getFullName();apogee.codeCompiler.processCode(e,f),a.setCodeInfo(e)},apogee.updatemember.applyData=function(a,b){a.clearErrors(),a.setData(b)},apogee.updatemember.loadMemberName=function(a,b){if(a.memberName){var c=a.memberName.split(".");a.member=b.getImpactor(c)}if(!a.member)throw new Error("Member not found for action: "+a.action)},apogee.updatemember.UPDATE_DATA_ACTION_INFO={actionFunction:apogee.updatemember.updateData,checkUpdateAll:!1,updateDependencies:!0,addToRecalc:!1,addDependenceiesToRecalc:!0,event:apogee.updatemember.MEMBER_UPDATED_EVENT},apogee.updatemember.UPDATE_CODE_ACTION_INFO={actionFunction:apogee.updatemember.updateCode,checkUpdateAll:!1,updateDependencies:!0,addToRecalc:!0,event:apogee.updatemember.MEMBER_UPDATED_EVENT},apogee.updatemember.UPDATE_DATA_PENDING_ACTION_INFO={actionFunction:apogee.updatemember.updateDataPending,checkUpdateAll:!1,updateDependencies:!0,addToRecalc:!1,addDependenceiesToRecalc:!0,event:apogee.updatemember.MEMBER_UPDATED_EVENT},apogee.updatemember.UPDATE_ASYNCH_DATA_ACTION_INFO={actionFunction:apogee.updatemember.asynchFunctionUpdateData,checkUpdateAll:!1,updateDependencies:!1,addToRecalc:!1,addDependenceiesToRecalc:!0,event:apogee.updatemember.MEMBER_UPDATED_EVENT},apogee.updatemember.UPDATE_ASYNCH_ERROR_ACTION_INFO={actionFunction:apogee.updatemember.asynchFunctionUpdateError,checkUpdateAll:!1,updateDependencies:!1,addToRecalc:!1,addDependenceiesToRecalc:!0,event:apogee.updatemember.MEMBER_UPDATED_EVENT},apogee.updatemember.UPDATE_DESCRIPTION_ACTION_INFO={actionFunction:apogee.updatemember.updateDescription,checkUpdateAll:!1,updateDependencies:!1,addToRecalc:!1,addDependenceiesToRecalc:!1,event:apogee.updatemember.MEMBER_UPDATED_EVENT},apogee.action.addActionInfo(apogee.updatemember.UPDATE_DATA_ACTION_NAME,apogee.updatemember.UPDATE_DATA_ACTION_INFO),apogee.action.addActionInfo(apogee.updatemember.UPDATE_CODE_ACTION_NAME,apogee.updatemember.UPDATE_CODE_ACTION_INFO),apogee.action.addActionInfo(apogee.updatemember.UPDATE_DATA_PENDING_ACTION_NAME,apogee.updatemember.UPDATE_DATA_PENDING_ACTION_INFO),apogee.action.addActionInfo(apogee.updatemember.UPDATE_ASYNCH_DATA_ACTION_NAME,apogee.updatemember.UPDATE_ASYNCH_DATA_ACTION_INFO),apogee.action.addActionInfo(apogee.updatemember.UPDATE_ASYNCH_ERROR_ACTION_NAME,apogee.updatemember.UPDATE_ASYNCH_ERROR_ACTION_INFO),apogee.action.addActionInfo(apogee.updatemember.UPDATE_DESCRIPTION_ACTION_NAME,apogee.updatemember.UPDATE_DESCRIPTION_ACTION_INFO),apogee.movemember={},apogee.movemember.ACTION_NAME="moveMember",apogee.movemember.moveMember=function(a,b,c){var d=a.member,e=[];apogee.movemember.loadMovedList(d,e),d.move(a.name,a.owner);for(var f=0;f<e.length;f++){var g,h=e[f];h===d?g=a:(g={},g.action="moveMember",g.member=d,g.name=d.getName(),g.owner=d.getOwner(),g.actionInfo=a.actionInfo),c.push(g)}},apogee.movemember.loadMovedList=function(a,b){if(b.push(a),a.isParent){var c=a.getChildMap();for(var d in c){var e=c[d];apogee.movemember.loadMovedList(e,b)}}else if(a.isRootHolder){var f=a.getRoot();apogee.movemember.loadMovedList(f,b)}},apogee.movemember.ACTION_INFO={actionFunction:apogee.movemember.moveMember,checkUpdateAll:!0,updateDependencies:!0,addToRecalc:!0,event:apogee.updatemember.MEMBER_UPDATED_EVENT},apogee.action.addActionInfo(apogee.movemember.ACTION_NAME,apogee.movemember.ACTION_INFO),apogee.deletemember={},apogee.deletemember.ACTION_NAME="deleteMember",apogee.deletemember.MEMBER_DELETED_EVENT="memberDeleted",apogee.deletemember.deleteMember=function(a,b,c){var d=[];apogee.deletemember.getDeleteList(a.member,d);for(var e=0;e<d.length;e++){var f=d[e];f.onDeleteChild(),f.isDependent&&f.onDeleteDependent();var g;f==a.member?g=a:(g={},g.action="deleteMember",g.member=f,g.actionInfo=a.actionInfo),c.push(g)}},apogee.deletemember.getDeleteList=function(a,b){if(a.isParent){var c=a.getChildMap();for(var d in c){var e=c[d];apogee.deletemember.getDeleteList(e,b)}}else if(a.isRootHolder){var f=a.getRoot();apogee.deletemember.getDeleteList(f,b)}b.push(a)},apogee.deletemember.ACTION_INFO={actionFunction:apogee.deletemember.deleteMember,checkUpdateAll:!0,updateDependencies:!1,addToRecalc:!1,event:apogee.deletemember.MEMBER_DELETED_EVENT},apogee.action.addActionInfo(apogee.deletemember.ACTION_NAME,apogee.deletemember.ACTION_INFO),apogee.updatefolderfunction={},apogee.updatefolderfunction.ACTION_NAME="updateFolderFunction",apogee.updatefolderfunction.updateProperties=function(a,b,c){var d=a.member;d.setArgList(a.argList),d.setReturnValueString(a.returnValueString),c.push(a)},apogee.updatefolderfunction.ACTION_INFO={actionFunction:apogee.updatefolderfunction.updateProperties,checkUpdateAll:!1,updateDependencies:!1,addToRecalc:!0,event:apogee.updatemember.MEMBER_UPDATED_EVENT},apogee.action.addActionInfo(apogee.updatefolderfunction.ACTION_NAME,apogee.updatefolderfunction.ACTION_INFO),apogee.action.Messenger=function(a){this.dataUpdate=function(b,c){apogee.action.dataUpdate(b,a,c)},this.compoundDataUpdate=function(b){apogee.action.compoundDataUpdate(b,a)},this.errorUpdate=function(b,c){apogee.action.errorUpdate(b,a,c)},this.asynchDataUpdate=function(b,c){apogee.action.asynchDataUpdate(b,a,c)}};